!function(t,s){var r,q={},p=function(g,f){var j,i,h;if("string"==typeof g){return m(g)}for(j=[],i=g.length,h=0;i>h;h++){j.push(m(g[h]))}return f.apply(null,j)},o=function(e,d,f){2===arguments.length&&(f=d,d=null),p(d||[],function(){n(e,f,arguments)})},n=function(e,d,j){var i,h={exports:d};"function"==typeof d&&(j.length||(j=[p,h.exports,h]),i=d.apply(null,j),void 0!==i&&(h.exports=i)),q[e]=h.exports},m=function(a){var d=q[a]||t[a];if(!d){throw new Error("`"+a+"` is undefined")}return d},l=function(i){var d,x,w,v,u,j;j=function(b){return b&&b.charAt(0).toUpperCase()+b.substr(1)};for(d in q){if(x=i,q.hasOwnProperty(d)){for(w=d.split("/"),u=j(w.pop());v=j(w.shift());){x[v]=x[v]||{},x=x[v]}x[u]=q[d]}}},k=s(t,o,p);l(k),"object"==typeof module&&"object"==typeof module.exports?module.exports=k:"function"==typeof define&&define.amd?define([],k):(r=t.WebUploader,t.WebUploader=k,t.WebUploader.noConflict=function(){t.WebUploader=r})}(this,function(e,d,f){return d("dollar-third",[],function(){return e.jQuery||e.Zepto}),d("dollar",["dollar-third"],function(b){return b}),d("promise-third",["dollar"],function(b){return{Deferred:b.Deferred,when:b.when,isPromise:function(c){return c&&"function"==typeof c.then}}}),d("promise",["promise-third"],function(b){return b}),d("base",["dollar","promise"],function(a,n){function m(b){return function(){return i.apply(b,arguments)}}function l(g,c){return function(){return g.apply(c,arguments)}}function k(g){var c;return Object.create?Object.create(g):(c=function(){},c.prototype=g,new c)}var j=function(){},i=Function.call;return{version:"0.1.2",$:a,Deferred:n.Deferred,isPromise:n.isPromise,when:n.when,browser:function(p){var o={},v=p.match(/WebKit\/([\d.]+)/),u=p.match(/Chrome\/([\d.]+)/)||p.match(/CriOS\/([\d.]+)/),t=p.match(/MSIE\s([\d\.]+)/)||p.match(/(?:trident)(?:.*rv:([\w.]+))?/i),s=p.match(/Firefox\/([\d.]+)/),r=p.match(/Safari\/([\d.]+)/),q=p.match(/OPR\/([\d.]+)/);return v&&(o.webkit=parseFloat(v[1])),u&&(o.chrome=parseFloat(u[1])),t&&(o.ie=parseFloat(t[1])),s&&(o.firefox=parseFloat(s[1])),r&&(o.safari=parseFloat(r[1])),q&&(o.opera=parseFloat(q[1])),o}(navigator.userAgent),os:function(h){var g={},p=h.match(/(?:Android);?[\s\/]+([\d.]+)?/),o=h.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return p&&(g.android=parseFloat(p[1])),o&&(g.ios=parseFloat(o[1].replace(/_/g,"."))),g}(navigator.userAgent),inherits:function(b,o,h){var g;return"function"==typeof o?(g=o,o=null):g=o&&o.hasOwnProperty("constructor")?o.constructor:function(){return b.apply(this,arguments)},a.extend(!0,g,b,h||{}),g.__super__=b.prototype,g.prototype=k(b.prototype),o&&a.extend(!0,g.prototype,o),g},noop:j,bindFn:l,log:function(){return e.console?l(console.log,console):j}(),nextTick:function(){return function(b){setTimeout(b,1)}}(),slice:m([].slice),guid:function(){var b=0;return function(g){for(var o=(+new Date).toString(32),h=0;5>h;h++){o+=Math.floor(65535*Math.random()).toString(32)}return(g||"wu_")+o+(b++).toString(32)}}(),formatSize:function(h,g,p){var o;for(p=p||["B","K","M","G","TB"];(o=p.shift())&&h>1024;){h/=1024}return("B"===o?h:h.toFixed(g||2))+o}}}),d("mediator",["base"],function(j){function i(h,g,r,q){return m.grep(h,function(b){return !(!b||g&&b.e!==g||r&&b.cb!==r&&b.cb._cb!==r||q&&b.ctx!==q)})}function p(h,g,q){m.each((h||"").split(k),function(b,c){q(c,g)})}function o(h,g){for(var t,s=!1,r=-1,q=h.length;++r<q;){if(t=h[r],t.cb.apply(t.ctx2,g)===!1){s=!0;break}}return !s}var n,m=j.$,l=[].slice,k=/\s+/;return n={on:function(g,c,r){var q,h=this;return c?(q=this._events||(this._events=[]),p(g,c,function(t,s){var u={e:t};u.cb=s,u.ctx=r,u.ctx2=r||h,u.id=q.length,q.push(u)}),this):this},once:function(g,c,q){var h=this;return c?(p(g,c,function(s,r){var t=function(){return h.off(s,t),r.apply(q||h,arguments)};t._cb=r,h.on(s,t,q)}),h):h},off:function(b,q,h){var c=this._events;return c?b||q||h?(p(b,q,function(g,r){m.each(i(c,g,r,h),function(){delete c[this.id]})}),this):(this._events=[],this):this},trigger:function(b){var q,h,g;return this._events&&b?(q=l.call(arguments,1),h=i(this._events,b),g=i(this._events,"all"),o(h,q)&&o(g,arguments)):this}},m.extend({installTo:function(b){return m.extend(b,n)}},n)}),d("uploader",["base","mediator"],function(h,g){function j(b){this.options=i.extend(!0,{},j.options,b),this._init(this.options)}var i=h.$;return j.options={},g.installTo(j.prototype),i.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(k,c){j.prototype[k]=function(){return this.request(c,arguments)}}),i.extend(j.prototype,{state:"pending",_init:function(k){var c=this;c.request("init",k,function(){c.state="ready",c.trigger("ready")})},option:function(l,k){var m=this.options;return arguments.length>1?void (i.isPlainObject(k)&&i.isPlainObject(m[l])?i.extend(m[l],k):m[l]=k):l?m[l]:m},getStats:function(){var b=this.request("get-stats");return{successNum:b.numOfSuccess,cancelNum:b.numOfCancel,invalidNum:b.numOfInvalid,uploadFailNum:b.numOfUploadFailed,queueNum:b.numOfQueue}},trigger:function(b){var m=[].slice.call(arguments,1),l=this.options,k="on"+b.substring(0,1).toUpperCase()+b.substring(1);return g.trigger.apply(this,arguments)===!1||i.isFunction(l[k])&&l[k].apply(this,m)===!1||i.isFunction(this[k])&&this[k].apply(this,m)===!1||g.trigger.apply(g,[this,b].concat(m))===!1?!1:!0},request:h.noop}),h.create=j.create=function(b){return new j(b)},h.Uploader=j,j}),d("runtime/runtime",["base","mediator"],function(h,g){function l(a){this.options=k.extend({container:document.body},a),this.uid=h.guid("rt_")}var k=h.$,j={},i=function(m){for(var c in m){if(m.hasOwnProperty(c)){return c}}return null};return k.extend(l.prototype,{getContainer:function(){var n,m,o=this.options;return this._container?this._container:(n=k(o.container||document.body),m=k(document.createElement("div")),m.attr("id","rt_"+this.uid),m.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.append(m),n.addClass("webuploader-container"),this._container=m,m)},init:h.noop,exec:h.noop,destroy:function(){this._container&&this._container.parentNode.removeChild(this.__container),this.off()}}),l.orders="html5,flash",l.addRuntime=function(m,c){j[m]=c},l.hasRuntime=function(b){return !!(b?j[b]:i(j))},l.create=function(m,c){var o,n;if(c=c||l.orders,k.each(c.split(/\s*,\s*/g),function(){return j[this]?(o=this,!1):void 0}),o=o||i(j),!o){throw new Error("Runtime Error")}return n=new j[o](m)},g.installTo(l.prototype),l}),d("runtime/client",["base","mediator","runtime/runtime"],function(h,g,k){function j(a,m){var l,c=h.Deferred();this.uid=h.guid("client_"),this.runtimeReady=function(b){return c.done(b)},this.connectRuntime=function(n,o){if(l){throw new Error("already connected!")}return c.done(o),"string"==typeof n&&i.get(n)&&(l=i.get(n)),l=l||i.get(null,m),l?(h.$.extend(l.options,n),l.__promise.then(c.resolve),l.__client++):(l=k.create(n,n.runtimeOrder),l.__promise=c.promise(),l.once("ready",c.resolve),l.init(),i.add(l),l.__client=1),m&&(l.__standalone=m),l},this.getRuntime=function(){return l},this.disconnectRuntime=function(){l&&(l.__client--,l.__client<=0&&(i.remove(l),delete l.__promise,l.destroy()),l=null)},this.exec=function(){if(l){var b=h.slice(arguments);return a&&b.unshift(a),l.exec.apply(this,b)}},this.getRuid=function(){return l&&l.uid},this.destroy=function(b){return function(){b&&b.apply(this,arguments),this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()}}(this.destroy)}var i;return i=function(){var b={};return{add:function(a){b[a.uid]=a},get:function(a,m){var l;if(a){return b[a]}for(l in b){if(!m||!b[l].__standalone){return b[l]}}return null},remove:function(a){delete b[a.uid]}}}(),g.installTo(j.prototype),j}),d("lib/dnd",["base","mediator","runtime/client"],function(h,g,k){function j(b){b=this.options=i.extend({},j.options,b),b.container=i(b.container),b.container.length&&k.call(this,"DragAndDrop")}var i=h.$;return j.options={accept:null,disableGlobalDnd:!1},h.inherits(k,{constructor:j,init:function(){var b=this;b.connectRuntime(b.options,function(){b.exec("init"),b.trigger("ready")})},destroy:function(){this.disconnectRuntime()}}),g.installTo(j.prototype),j}),d("widgets/widget",["base","uploader"],function(j,i){function p(h){if(!h){return !1}var g=h.length,q=n.type(h);return 1===h.nodeType&&g?!0:"array"===q||"function"!==q&&"string"!==q&&(0===g||"number"==typeof g&&g>0&&g-1 in h)}function o(b){this.owner=b,this.options=b.options}var n=j.$,m=i.prototype._init,l={},k=[];return n.extend(o.prototype,{init:j.noop,invoke:function(h,g){var q=this.responseMap;return q&&h in q&&q[h] in this&&n.isFunction(this[q[h]])?this[q[h]].apply(this,g):l},request:function(){return this.owner.request.apply(this.owner,arguments)}}),n.extend(i.prototype,{_init:function(){var g=this,c=g._widgets=[];return n.each(k,function(b,a){c.push(new a(g))}),m.apply(g,arguments)},request:function(y,x,w){var v,u,t,s,r=0,q=this._widgets,g=q.length,c=[],a=[];for(x=p(x)?x:[x];g>r;r++){v=q[r],u=v.invoke(y,x),u!==l&&(j.isPromise(u)?a.push(u):c.push(u))}return w||a.length?(t=j.when.apply(j,a),s=t.pipe?"pipe":"then",t[s](function(){var h=j.Deferred(),z=arguments;return setTimeout(function(){h.resolve.apply(h,z)},1),h.promise()})[s](w||j.noop)):c[0]}}),i.register=o.register=function(a,r){var q,h={init:"init"};return 1===arguments.length?(r=a,r.responseMap=h):r.responseMap=n.extend(h,a),q=j.inherits(o,r),k.push(q),q},o}),d("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(h,g,j){var i=h.$;return g.options.dnd="",g.register({init:function(a){if(a.dnd&&"html5"===this.request("predict-runtime-type")){var m,l=this,k=h.Deferred(),c=i.extend({},{disableGlobalDnd:a.disableGlobalDnd,container:a.dnd,accept:a.accept});return m=new j(c),m.once("ready",k.resolve),m.on("drop",function(b){l.request("add-file",[b])}),m.on("accept",function(b){return l.owner.trigger("dndAccept",b)}),m.init(),k.promise()}}})}),d("lib/filepaste",["base","mediator","runtime/client"],function(h,g,k){function j(b){b=this.options=i.extend({},b),b.container=i(b.container||document.body),k.call(this,"FilePaste")}var i=h.$;return h.inherits(k,{constructor:j,init:function(){var b=this;b.connectRuntime(b.options,function(){b.exec("init"),b.trigger("ready")})},destroy:function(){this.exec("destroy"),this.disconnectRuntime(),this.off()}}),g.installTo(j.prototype),j}),d("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(h,g,j){var i=h.$;return g.register({init:function(a){if(a.paste&&"html5"===this.request("predict-runtime-type")){var m,l=this,k=h.Deferred(),c=i.extend({},{container:a.paste,accept:a.accept});return m=new j(c),m.once("ready",k.resolve),m.on("paste",function(b){l.owner.request("add-file",[b])}),m.init(),k.promise()}}})}),d("lib/blob",["base","runtime/client"],function(h,g){function i(b,k){var j=this;j.source=k,j.ruid=b,g.call(j,"Blob"),this.uid=k.uid||this.uid,this.type=k.type||"",this.size=k.size||0,b&&j.connectRuntime(b)}return h.inherits(g,{constructor:i,slice:function(j,c){return this.exec("slice",j,c)},getSource:function(){return this.source}}),i}),d("lib/file",["base","lib/blob"],function(h,g){function k(b,m){var l;g.apply(this,arguments),this.name=m.name||"untitled"+j++,l=i.exec(m.name)?RegExp.$1.toLowerCase():"",!l&&this.type&&(l=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(this.type)?RegExp.$1.toLowerCase():"",this.name+="."+l),!this.type&&~"jpg,jpeg,png,gif,bmp".indexOf(l)&&(this.type="image/"+("jpg"===l?"jpeg":l)),this.ext=l,this.lastModifiedDate=m.lastModifiedDate||(new Date).toLocaleString()}var j=1,i=/\.([^.]+)$/;return h.inherits(g,k)}),d("lib/filepicker",["base","runtime/client","lib/file"],function(a,j,i){function h(b){if(b=this.options=g.extend({},h.options,b),b.container=g(b.id),!b.container.length){throw new Error("按钮指定错误")}b.innerHTML=b.innerHTML||b.label||b.container.html()||"",b.button=g(b.button||document.createElement("div")),b.button.html(b.innerHTML),b.container.html(b.button),j.call(this,"FilePicker",!0)}var g=a.$;return h.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"},a.inherits(j,{constructor:h,init:function(){var k=this,m=k.options,l=m.button;l.addClass("webuploader-pick"),k.on("all",function(b){var c;switch(b){case"mouseenter":l.addClass("webuploader-pick-hover");break;case"mouseleave":l.removeClass("webuploader-pick-hover");break;case"change":c=k.exec("getFiles"),k.trigger("select",g.map(c,function(n){return n=new i(k.getRuid(),n),n._refer=m.container,n}),m.container)}}),k.connectRuntime(m,function(){k.refresh(),k.exec("init",m),k.trigger("ready")}),g(e).on("resize",function(){k.refresh()})},refresh:function(){var l=this.getRuntime().getContainer(),k=this.options.button,o=k.outerWidth?k.outerWidth():k.width(),n=k.outerHeight?k.outerHeight():k.height(),m=k.offset();o&&n&&l.css({bottom:"auto",right:"auto",width:o+"px",height:n+"px"}).offset(m)},enable:function(){var b=this.options.button;b.removeClass("webuploader-pick-disable"),this.refresh()},disable:function(){var b=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"}),b.addClass("webuploader-pick-disable")},destroy:function(){this.runtime&&(this.exec("destroy"),this.disconnectRuntime())}}),h}),d("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(h,g,j){var i=h.$;return i.extend(g.options,{pick:null,accept:null}),g.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(b){return this.pickers=[],b.pick&&this.addButton(b.pick)},refresh:function(){i.each(this.pickers,function(){this.refresh()})},addButton:function(a){var o,n,m,l=this,k=l.options,c=k.accept;if(a){return m=h.Deferred(),i.isPlainObject(a)||(a={id:a}),o=i.extend({},a,{accept:i.isPlainObject(c)?[c]:c,swf:k.swf,runtimeOrder:k.runtimeOrder}),n=new j(o),n.once("ready",m.resolve),n.on("select",function(b){l.owner.request("add-file",[b])}),n.init(),this.pickers.push(n),m.promise()}},disable:function(){i.each(this.pickers,function(){this.disable()})},enable:function(){i.each(this.pickers,function(){this.enable()})}})}),d("file",["base","mediator"],function(r,q){function p(){return m+l++}function o(b){this.name=b.name||"Untitled",this.size=b.size||0,this.type=b.type||"application",this.lastModifiedDate=b.lastModifiedDate||1*new Date,this.id=p(),this.ext=k.exec(this.name)?RegExp.$1:"",this.statusText="",j[this.id]=o.Status.INITED,this.source=b,this.loaded=0,this.on("error",function(c){this.setStatus(o.Status.ERROR,c)})}var n=r.$,m="WU_FILE_",l=0,k=/\.([^.]+)$/,j={};return n.extend(o.prototype,{setStatus:function(h,g){var i=j[this.id];"undefined"!=typeof g&&(this.statusText=g),h!==i&&(j[this.id]=h,this.trigger("statuschange",h,i))},getStatus:function(){return j[this.id]},getSource:function(){return this.source},destory:function(){delete j[this.id]}}),q.installTo(o.prototype),o.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},o}),d("queue",["base","mediator","file"],function(h,g,l){function k(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0},this._queue=[],this._map={}}var j=h.$,i=l.Status;return j.extend(k.prototype,{append:function(b){return this._queue.push(b),this._fileAdded(b),this},prepend:function(b){return this._queue.unshift(b),this._fileAdded(b),this},getFile:function(b){return"string"!=typeof b?b:this._map[b]},fetch:function(n){var m,p,o=this._queue.length;for(n=n||i.QUEUED,m=0;o>m;m++){if(p=this._queue[m],n===p.getStatus()){return p}}return null},sort:function(b){"function"==typeof b&&this._queue.sort(b)},getFiles:function(){for(var n,m=[].slice.call(arguments,0),q=[],p=0,o=this._queue.length;o>p;p++){n=this._queue[p],(!m.length||~j.inArray(n.getStatus(),m))&&q.push(n)}return q},_fileAdded:function(n){var m=this,o=this._map[n.id];o||(this._map[n.id]=n,n.on("statuschange",function(b,p){m._onFileStatusChange(b,p)})),n.setStatus(i.QUEUED)},_onFileStatusChange:function(n,m){var o=this.stats;switch(m){case i.PROGRESS:o.numOfProgress--;break;case i.QUEUED:o.numOfQueue--;break;case i.ERROR:o.numOfUploadFailed--;break;case i.INVALID:o.numOfInvalid--}switch(n){case i.QUEUED:o.numOfQueue++;break;case i.PROGRESS:o.numOfProgress++;break;case i.ERROR:o.numOfUploadFailed++;break;case i.COMPLETE:o.numOfSuccess++;break;case i.CANCELLED:o.numOfCancel++;break;case i.INVALID:o.numOfInvalid++}}}),g.installTo(k.prototype),k}),d("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(r,q,p,o,n,m){var l=r.$,k=/\.\w+$/,j=o.Status;return q.register({"sort-files":"sortFiles","add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile",retry:"retry",reset:"reset","accept-file":"acceptFile"},{init:function(x){var w,v,u,t,s,g,c,a=this;if(l.isPlainObject(x.accept)&&(x.accept=[x.accept]),x.accept){for(s=[],u=0,v=x.accept.length;v>u;u++){t=x.accept[u].extensions,t&&s.push(t)}s.length&&(g="\\."+s.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"),a.accept=new RegExp(g,"i")}return a.queue=new p,a.stats=a.queue.stats,"html5"===this.request("predict-runtime-type")?(w=r.Deferred(),c=new m("Placeholder"),c.connectRuntime({runtimeOrder:"html5"},function(){a._ruid=c.getRuid(),w.resolve()}),w.promise()):void 0},_wrapFile:function(b){if(!(b instanceof o)){if(!(b instanceof n)){if(!this._ruid){throw new Error("Can't add external files.")}b=new n(this._ruid,b)}b=new o(b)}return b},acceptFile:function(g){var c=!g||g.size<6||this.accept&&k.exec(g.name)&&!this.accept.test(g.name);return !c},_addFile:function(g){var c=this;return g=c._wrapFile(g),c.owner.trigger("beforeFileQueued",g)?c.acceptFile(g)?(c.queue.append(g),c.owner.trigger("fileQueued",g),g):void c.owner.trigger("error","Q_TYPE_DENIED",g):void 0},getFile:function(b){return this.queue.getFile(b)},addFiles:function(g){var c=this;g.length||(g=[g]),g=l.map(g,function(b){return c._addFile(b)}),c.owner.trigger("filesQueued",g),c.options.auto&&c.request("start-upload")},getStats:function(){return this.stats},removeFile:function(g){var c=this;g=g.id?g:c.queue.getFile(g),g.setStatus(j.CANCELLED),c.owner.trigger("fileDequeued",g)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(h,g){var u,t,s,i=this;if(h){return h=h.id?h:i.queue.getFile(h),h.setStatus(j.QUEUED),void (g||i.request("start-upload"))}for(u=i.queue.getFiles(j.ERROR),t=0,s=u.length;s>t;t++){h=u[t],h.setStatus(j.QUEUED)}i.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.queue=new p,this.stats=this.queue.stats}})}),d("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(g,c){return g.support=function(){return c.hasRuntime.apply(c,arguments)},g.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType()){throw Error("Runtime Error")}},predictRuntmeType:function(){var b,j,i=this.options.runtimeOrder||c.orders,h=this.type;if(!h){for(i=i.split(/\s*,\s*/g),b=0,j=i.length;j>b;b++){if(c.hasRuntime(i[b])){this.type=h=i[b];break}}}return h}})}),d("lib/transport",["base","runtime/client","mediator"],function(h,g,k){function j(b){var l=this;b=l.options=i.extend(!0,{},j.options,b||{}),g.call(this,"Transport"),this._blob=null,this._formData=b.formData||{},this._headers=b.headers||{},this.on("progress",this._timeout),this.on("load error",function(){l.trigger("progress",1),clearTimeout(l._timer)})}var i=h.$;return j.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:120000,formData:{},headers:{},sendAsBinary:!1},i.extend(j.prototype,{appendBlob:function(m,l,p){var o=this,n=o.options;o.getRuid()&&o.disconnectRuntime(),o.connectRuntime(l.ruid,function(){o.exec("init")}),o._blob=l,n.fileVal=m||n.fileVal,n.filename=p||n.filename},append:function(l,c){"object"==typeof l?i.extend(this._formData,l):this._formData[l]=c},setRequestHeader:function(l,c){"object"==typeof l?i.extend(this._headers,l):this._headers[l]=c},send:function(b){this.exec("send",b),this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var l=this,c=l.options.timeout;c&&(clearTimeout(l._timer),l._timer=setTimeout(function(){l.abort(),l.trigger("error","timeout")},c))}}),k.installTo(j.prototype),j}),d("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(j,i,p,o){function n(y,x){for(var w,v=[],u=y.source,t=u.size,s=x?Math.ceil(t/x):1,r=0,q=0;s>q;){w=Math.min(x,t-r),v.push({file:y,start:r,end:x?r+w:t,total:t,chunks:s,chunk:q++}),r+=w}return y.blocks=v.concat(),y.remaning=v.length,{file:y,has:function(){return !!v.length},fetch:function(){return v.shift()}}}var m=j.$,l=j.isPromise,k=p.Status;m.extend(i.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:null}),i.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var a=this.owner;this.runing=!1,this.pool=[],this.pending=[],this.remaning=0,this.__tick=j.bindFn(this._tick,this),a.on("uploadComplete",function(b){b.blocks&&m.each(b.blocks,function(g,c){c.transport&&(c.transport.abort(),c.transport.destroy()),delete c.transport}),delete b.blocks,delete b.remaning})},start:function(){var a=this;m.each(a.request("get-files",k.INVALID),function(){a.request("remove-file",this)}),a.runing||(a.runing=!0,m.each(a.pool,function(b,h){var g=h.file;g.getStatus()===k.INTERRUPT&&(g.setStatus(k.PROGRESS),a._trigged=!1,h.transport&&h.transport.send())}),a._trigged=!1,a.owner.trigger("startUpload"),j.nextTick(a.__tick))},stop:function(g){var c=this;c.runing!==!1&&(c.runing=!1,g&&m.each(c.pool,function(q,h){h.transport&&h.transport.abort(),h.file.setStatus(k.INTERRUPT)}),c.owner.trigger("stopUpload"))},isInProgress:function(){return !!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(g,c){g=this.request("get-file",g),g.setStatus(c||k.COMPLETE),g.skipped=!0,g.blocks&&m.each(g.blocks,function(q,h){var r=h.transport;r&&(r.abort(),r.destroy(),delete h.transport)}),this.owner.trigger("uploadSkip",g)},_tick:function(){var a,q,h=this,g=h.options;return h._promise?h._promise.always(h.__tick):void (h.pool.length<g.threads&&(q=h._nextBlock())?(h._trigged=!1,a=function(c){h._promise=null,c&&c.file&&h._startSend(c),j.nextTick(h.__tick)},h._promise=l(q)?q.always(a):a(q)):h.remaning||h.getStats().numOfQueue||(h.runing=!1,h._trigged||j.nextTick(function(){h.owner.trigger("uploadFinished")}),h._trigged=!0))},_nextBlock:function(){var h,g,s=this,r=s._act,q=s.options;return r&&r.has()&&r.file.getStatus()===k.PROGRESS?(q.prepareNextFile&&!s.pending.length&&s._prepareNextFile(),r.fetch()):s.runing?(!s.pending.length&&s.getStats().numOfQueue&&s._prepareNextFile(),h=s.pending.shift(),g=function(b){return b?(r=n(b,q.chunked?q.chunkSize:0),s._act=r,r.fetch()):null},l(h)?h[h.pipe?"pipe":"then"](g):g(h)):void 0},_prepareNextFile:function(){var h,g=this,r=g.request("fetch-file"),q=g.pending;r&&(h=g.request("before-send-file",r,function(){return r.getStatus()===k.QUEUED?(g.owner.trigger("uploadStart",r),r.setStatus(k.PROGRESS),r):g._finishFile(r)}),h.done(function(){var a=m.inArray(h,q);~a&&q.splice(a,1,r)}),h.fail(function(b){r.setStatus(k.ERROR,b),g.owner.trigger("uploadError",r,b),g.owner.trigger("uploadComplete",r)}),q.push(h))},_popBlock:function(g){var c=m.inArray(g,this.pool);this.pool.splice(c,1),g.file.remaning--,this.remaning--},_startSend:function(a){var q,h=this,g=a.file;h.pool.push(a),h.remaning++,a.blob=1===a.chunks?g.source:g.source.slice(a.start,a.end),q=h.request("before-send",a,function(){g.getStatus()===k.PROGRESS?h._doSend(a):(h._popBlock(a),j.nextTick(h.__tick))}),q.fail(function(){1===g.remaning?h._finishFile(g).always(function(){a.percentage=1,h._popBlock(a),h.owner.trigger("uploadComplete",g),j.nextTick(h.__tick)}):(a.percentage=1,h._popBlock(a),j.nextTick(h.__tick))})},_doSend:function(x){var w,v,u=this,t=u.owner,s=u.options,r=x.file,q=new o(s),h=m.extend({},s.formData),a=m.extend({},s.headers);x.transport=q,q.on("destroy",function(){delete x.transport,u._popBlock(x),j.nextTick(u.__tick)}),q.on("progress",function(b){var y=0,g=0;y=x.percentage=b,x.chunks>1&&(m.each(r.blocks,function(z,c){g+=(c.percentage||0)*(c.end-c.start)}),y=g/r.size),t.trigger("uploadProgress",r,y||0)}),w=function(b){var g;return v=q.getResponseAsJson()||{},v._raw=q.getResponse(),g=function(c){b=c},t.trigger("uploadAccept",x,v,g)||(b=b||"server"),b},q.on("error",function(b,c){x.retried=x.retried||0,x.chunks>1&&~"http,abort".indexOf(b)&&x.retried<s.chunkRetry?(x.retried++,q.send()):(c||"server"!==b||(b=w(b)),r.setStatus(k.ERROR,b),t.trigger("uploadError",r,b),t.trigger("uploadComplete",r))}),q.on("load",function(){var b;return(b=w())?void q.trigger("error",b,!0):void (1===r.remaning?u._finishFile(r,v):q.destroy())}),h=m.extend(h,{id:r.id,name:r.name,type:r.type,lastModifiedDate:r.lastModifiedDate,size:r.size}),x.chunks>1&&m.extend(h,{chunks:x.chunks,chunk:x.chunk}),t.trigger("uploadBeforeSend",x,h,a),q.appendBlob(s.fileVal,x.blob,r.name),q.append(h),q.setRequestHeader(a),q.send()},_finishFile:function(h,g,r){var q=this.owner;return q.request("after-send-file",arguments,function(){h.setStatus(k.COMPLETE),q.trigger("uploadSuccess",h,g,r)}).fail(function(a){h.getStatus()===k.PROGRESS&&h.setStatus(k.ERROR,a),q.trigger("uploadError",h,a)}).always(function(){q.trigger("uploadComplete",h)})}})}),d("widgets/validator",["base","uploader","file","widgets/widget"],function(h,g,l){var k,j=h.$,i={};return k={addValidator:function(m,c){i[m]=c},removeValidator:function(b){delete i[b]}},g.register({init:function(){var b=this;j.each(i,function(){this.call(b.owner)})}}),k.addValidator("fileNumLimit",function(){var n=this,m=n.options,q=0,p=m.fileNumLimit>>0,o=!0;p&&(n.on("beforeFileQueued",function(b){return q>=p&&o&&(o=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",p,b),setTimeout(function(){o=!0},1)),q>=p?!1:!0}),n.on("fileQueued",function(){q++}),n.on("fileDequeued",function(){q--}),n.on("uploadFinished",function(){q=0}))}),k.addValidator("fileSizeLimit",function(){var n=this,m=n.options,q=0,p=m.fileSizeLimit>>0,o=!0;p&&(n.on("beforeFileQueued",function(r){var c=q+r.size>p;return c&&o&&(o=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",p,r),setTimeout(function(){o=!0},1)),c?!1:!0}),n.on("fileQueued",function(b){q+=b.size}),n.on("fileDequeued",function(b){q-=b.size}),n.on("uploadFinished",function(){q=0}))}),k.addValidator("fileSingleSizeLimit",function(){var m=this,c=m.options,n=c.fileSingleSizeLimit;n&&m.on("beforeFileQueued",function(b){return b.size>n?(b.setStatus(l.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",b),!1):void 0})}),k.addValidator("duplicate",function(){function n(r){for(var q,u=0,t=0,s=r.length;s>t;t++){q=r.charCodeAt(t),u=q+(u<<6)+(u<<16)-u}return u}var m=this,p=m.options,o={};p.duplicate||(m.on("beforeFileQueued",function(a){var q=a.__hash||(a.__hash=n(a.name+a.size+a.lastModifiedDate));return o[q]?(this.trigger("error","F_DUPLICATE",a),!1):void 0}),m.on("fileQueued",function(q){var c=q.__hash;c&&(o[c]=!0)}),m.on("fileDequeued",function(q){var c=q.__hash;c&&delete o[c]}))}),k}),d("runtime/compbase",[],function(){function b(g,c){this.owner=g,this.options=g.options,this.getRuntime=function(){return c},this.getRuid=function(){return c.uid},this.trigger=function(){return g.trigger.apply(g,arguments)}}return b}),d("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(a,l,k){function j(){var b={},g=this,c=this.destory;l.apply(g,arguments),g.type=i,g.exec=function(r,q){var p,o=this,n=o.uid,m=a.slice(arguments,2);return h[r]&&(p=b[n]=b[n]||new h[r](o,g),p[q])?p[q].apply(p,m):void 0},g.destory=function(){return c&&c.apply(this,arguments)}}var i="html5",h={};return a.inherits(l,{constructor:j,init:function(){var b=this;setTimeout(function(){b.trigger("ready")},1)}}),j.register=function(b,m){var g=h[b]=a.inherits(k,m);return g},e.Blob&&e.FileReader&&e.DataView&&l.addRuntime(i,j),j}),d("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(g,c){return g.register("Blob",{slice:function(b,j){var i=this.owner.source,h=i.slice||i.webkitSlice||i.mozSlice;return i=h.call(i,b,j),new c(this.getRuid(),i)}})}),d("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(h,g,k){var j=h.$,i="webuploader-dnd-";return g.register("DragAndDrop",{init:function(){var a=this.elem=this.options.container;this.dragEnterHandler=h.bindFn(this._dragEnterHandler,this),this.dragOverHandler=h.bindFn(this._dragOverHandler,this),this.dragLeaveHandler=h.bindFn(this._dragLeaveHandler,this),this.dropHandler=h.bindFn(this._dropHandler,this),this.dndOver=!1,a.on("dragenter",this.dragEnterHandler),a.on("dragover",this.dragOverHandler),a.on("dragleave",this.dragLeaveHandler),a.on("drop",this.dropHandler),this.options.disableGlobalDnd&&(j(document).on("dragover",this.dragOverHandler),j(document).on("drop",this.dropHandler))},_dragEnterHandler:function(m){var l,o=this,n=o._denied||!1;return m=m.originalEvent||m,o.dndOver||(o.dndOver=!0,l=m.dataTransfer.items,l&&l.length&&(o._denied=n=!o.trigger("accept",l)),o.elem.addClass(i+"over"),o.elem[n?"addClass":"removeClass"](i+"denied")),m.dataTransfer.dropEffect=n?"none":"copy",!1},_dragOverHandler:function(l){var c=this.elem.parent().get(0);return c&&!j.contains(c,l.currentTarget)?!1:(clearTimeout(this._leaveTimer),this._dragEnterHandler.call(this,l),!1)},_dragLeaveHandler:function(){var l,c=this;return l=function(){c.dndOver=!1,c.elem.removeClass(i+"over "+i+"denied")},clearTimeout(c._leaveTimer),c._leaveTimer=setTimeout(l,100),!1},_dropHandler:function(l){var c=this,n=c.getRuid(),m=c.elem.parent().get(0);return m&&!j.contains(m,l.currentTarget)?!1:(c._getTansferFiles(l,function(b){c.trigger("drop",j.map(b,function(o){return new k(n,o)}))}),c.dndOver=!1,c.elem.removeClass(i+"over"),!1)},_getTansferFiles:function(x,w){var v,u,t,s,r,q,p,o,n=[],a=[];for(x=x.originalEvent||x,t=x.dataTransfer,v=t.items,u=t.files,o=!(!v||!v[0].webkitGetAsEntry),q=0,p=u.length;p>q;q++){s=u[q],r=v&&v[q],o&&r.webkitGetAsEntry().isDirectory?a.push(this._traverseDirectoryTree(r.webkitGetAsEntry(),n)):n.push(s)}h.when.apply(h,a).done(function(){n.length&&w(n)})},_traverseDirectoryTree:function(a,n){var m=h.Deferred(),l=this;return a.isFile?a.file(function(b){n.push(b),m.resolve()}):a.isDirectory&&a.createReader().readEntries(function(c){var r,q=c.length,p=[],o=[];for(r=0;q>r;r++){p.push(l._traverseDirectoryTree(c[r],o))}h.when.apply(h,p).then(function(){n.push.apply(n,o),m.resolve()},m.reject)}),m.promise()},destroy:function(){var b=this.elem;b.off("dragenter",this.dragEnterHandler),b.off("dragover",this.dragEnterHandler),b.off("dragleave",this.dragLeaveHandler),b.off("drop",this.dropHandler),this.options.disableGlobalDnd&&(j(document).off("dragover",this.dragOverHandler),j(document).off("drop",this.dropHandler))}})}),d("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(h,g,i){return g.register("FilePaste",{init:function(){var a,o,n,m,l=this.options,k=this.elem=l.container,j=".*";if(l.accept){for(a=[],o=0,n=l.accept.length;n>o;o++){m=l.accept[o].mimeTypes,m&&a.push(m)}a.length&&(j=a.join(","),j=j.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=j=new RegExp(j,"i"),this.hander=h.bindFn(this._pasteHander,this),k.on("paste",this.hander)},_pasteHander:function(j){var c,p,o,n,m,l=[],k=this.getRuid();for(j=j.originalEvent||j,c=j.clipboardData.items,n=0,m=c.length;m>n;n++){p=c[n],"file"===p.kind&&(o=p.getAsFile())&&l.push(new i(k,o))}l.length&&(j.preventDefault(),j.stopPropagation(),this.trigger("paste",l))},destroy:function(){this.elem.off("paste",this.hander)}})}),d("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(h,g){var i=h.$;return g.register("FilePicker",{init:function(){var t,s,r,q,p=this.getRuntime().getContainer(),o=this,n=o.owner,m=o.options,l=i(document.createElement("label")),c=i(document.createElement("input"));if(c.attr("type","file"),c.attr("name",m.name),c.addClass("webuploader-element-invisible"),l.on("click",function(){c.trigger("click")}),l.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),m.multiple&&c.attr("multiple","multiple"),m.accept&&m.accept.length>0){for(t=[],s=0,r=m.accept.length;r>s;s++){t.push(m.accept[s].mimeTypes)}c.attr("accept",t.join(","))}p.append(c),p.append(l),q=function(b){n.trigger(b.type)},c.on("change",function(k){var j,u=arguments.callee;o.files=k.target.files,j=this.cloneNode(!0),this.parentNode.replaceChild(j,this),c.off(),c=i(j).on("change",u).on("mouseenter mouseleave",q),n.trigger("change")}),l.on("mouseenter mouseleave",q)},getFiles:function(){return this.files},destroy:function(){}})}),d("runtime/html5/transport",["base","runtime/html5/runtime"],function(h,g){var j=h.noop,i=h.$;return g.register("Transport",{init:function(){this._status=0,this._response=null},send:function(){var a,q,p,o=this.owner,n=this.options,m=this._initAjax(),l=o._blob,k=n.server;n.sendAsBinary?(k+=(/\?/.test(k)?"&":"?")+i.param(o._formData),q=l.getSource()):(a=new FormData,i.each(o._formData,function(b,r){a.append(b,r)}),a.append(n.fileVal,l.getSource(),n.filename||o._formData.name||"")),n.withCredentials&&"withCredentials" in m?(m.open(n.method,k,!0),m.withCredentials=!0):m.open(n.method,k),this._setRequestHeader(m,n.headers),q?(m.overrideMimeType("application/octet-stream"),h.os.android?(p=new FileReader,p.onload=function(){m.send(this.result),p=p.onload=null},p.readAsArrayBuffer(q)):m.send(q)):m.send(a)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var b=this._xhr;b&&(b.upload.onprogress=j,b.onreadystatechange=j,b.abort(),this._xhr=b=null)},destroy:function(){this.abort()},_initAjax:function(){var k=this,c=new XMLHttpRequest,l=this.options;return !l.withCredentials||"withCredentials" in c||"undefined"==typeof XDomainRequest||(c=new XDomainRequest),c.upload.onprogress=function(a){var m=0;return a.lengthComputable&&(m=a.loaded/a.total),k.trigger("progress",m)},c.onreadystatechange=function(){return 4===c.readyState?(c.upload.onprogress=j,c.onreadystatechange=j,k._xhr=null,k._status=c.status,c.status>=200&&c.status<300?(k._response=c.responseText,k.trigger("load")):c.status>=500&&c.status<600?(k._response=c.responseText,k.trigger("error","server")):k.trigger("error",k._status?"http":"abort")):void 0},k._xhr=c,c},_setRequestHeader:function(k,c){i.each(c,function(a,l){k.setRequestHeader(a,l)})},_parseJson:function(l){var k;try{k=JSON.parse(l)}catch(m){k={}}return k}})}),d("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(a,p,o){function n(){var h;try{h=navigator.plugins["Shockwave Flash"],h=h.description}catch(g){try{h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){h="0.0"}}return h=h.match(/\d+/g),parseFloat(h[0]+"."+h[1],10)}function m(){function r(s,g){var v,u,t=s.type||s;v=t.split("::"),u=v[0],t=v[1],"Ready"===t&&u===c.uid?c.trigger("ready"):i[u]&&i[u].trigger(t.toLowerCase(),s,g)}var q={},i={},h=this.destory,c=this,b=a.guid("webuploader_");p.apply(c,arguments),c.type=k,c.exec=function(s,x){var w,v=this,u=v.uid,t=a.slice(arguments,2);return i[u]=v,j[s]&&(q[u]||(q[u]=new j[s](v,c)),w=q[u],w[x])?w[x].apply(w,t):c.flashExec.apply(v,arguments)},e[b]=function(){var g=arguments;setTimeout(function(){r.apply(null,g)},1)},this.jsreciver=b,this.destory=function(){return h&&h.apply(this,arguments)},this.flashExec=function(g,u){var t=c.getFlash(),s=a.slice(arguments,2);return t.exec(this.uid,g,u,s)}}var l=a.$,k="flash",j={};return a.inherits(p,{constructor:m,init:function(){var b,h=this.getContainer(),g=this.options;h.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),b='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+g.swf+'" ',a.browser.ie&&(b+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),b+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+g.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',h.html(b)},getFlash:function(){return this._flash?this._flash:(this._flash=l("#"+this.uid).get(0),this._flash)}}),m.register=function(b,g){return g=j[b]=a.inherits(o,l.extend({flashExec:function(){var h=this.owner,c=this.getRuntime();return c.flashExec.apply(h,arguments)}},g))},n()>=11.4&&p.addRuntime(k,m),m}),d("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(h,g){var i=h.$;return g.register("FilePicker",{init:function(j){var c,l,k=i.extend({},j);for(c=k.accept&&k.accept.length,l=0;c>l;l++){k.accept[l].title||(k.accept[l].title="Files")}delete k.button,delete k.container,this.flashExec("FilePicker","init",k)},destroy:function(){}})}),d("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(h,g,j){var i=h.$;return g.register("Transport",{init:function(){this._status=0,this._response=null,this._responseJson=null},send:function(){var l,k=this.owner,p=this.options,o=this._initAjax(),n=k._blob,m=p.server;o.connectRuntime(n.ruid),p.sendAsBinary?(m+=(/\?/.test(m)?"&":"?")+i.param(k._formData),l=n.uid):(i.each(k._formData,function(q,c){o.exec("append",q,c)}),o.exec("appendBlob",p.fileVal,n.uid,p.filename||k._formData.name||"")),this._setRequestHeader(o,p.headers),o.exec("send",{method:p.method,url:m},l)},getStatus:function(){return this._status},getResponse:function(){return this._response},getResponseAsJson:function(){return this._responseJson},abort:function(){var b=this._xhr;b&&(b.exec("abort"),b.destroy(),this._xhr=b=null)},destroy:function(){this.abort()},_initAjax:function(){var k=this,c=new j("XMLHttpRequest");return c.on("uploadprogress progress",function(a){return k.trigger("progress",a.loaded/a.total)}),c.on("load",function(){var b=c.exec("getStatus"),a="";return c.off(),k._xhr=null,b>=200&&300>b?(k._response=c.exec("getResponse"),k._responseJson=c.exec("getResponseAsJson")):b>=500&&600>b?(k._response=c.exec("getResponse"),k._responseJson=c.exec("getResponseAsJson"),a="server"):a="http",c.destroy(),c=null,a?k.trigger("error",a):k.trigger("load")}),c.on("error",function(){c.off(),k._xhr=null,k.trigger("error","http")}),k._xhr=c,c},_setRequestHeader:function(k,c){i.each(c,function(a,l){k.exec("setRequestHeader",a,l)})}})}),d("preset/withoutimage",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/transport","runtime/flash/filepicker","runtime/flash/transport"],function(b){return b}),d("webuploader",["preset/withoutimage"],function(b){return b}),f("webuploader")});