!function(t,s){var r,q={},p=function(g,f){var j,i,h;if("string"==typeof g){return m(g)}for(j=[],i=g.length,h=0;i>h;h++){j.push(m(g[h]))}return f.apply(null,j)},o=function(e,d,f){2===arguments.length&&(f=d,d=null),p(d||[],function(){n(e,f,arguments)})},n=function(e,d,j){var i,h={exports:d};"function"==typeof d&&(j.length||(j=[p,h.exports,h]),i=d.apply(null,j),void 0!==i&&(h.exports=i)),q[e]=h.exports},m=function(a){var d=q[a]||t[a];if(!d){throw new Error("`"+a+"` is undefined")}return d},l=function(i){var d,x,w,v,u,j;j=function(b){return b&&b.charAt(0).toUpperCase()+b.substr(1)};for(d in q){if(x=i,q.hasOwnProperty(d)){for(w=d.split("/"),u=j(w.pop());v=j(w.shift());){x[v]=x[v]||{},x=x[v]}x[u]=q[d]}}},k=s(t,o,p);l(k),"object"==typeof module&&"object"==typeof module.exports?module.exports=k:"function"==typeof define&&define.amd?define([],k):(r=t.WebUploader,t.WebUploader=k,t.WebUploader.noConflict=function(){t.WebUploader=r})}(this,function(e,d,f){return d("dollar-third",[],function(){return e.jQuery||e.Zepto}),d("dollar",["dollar-third"],function(b){return b}),d("promise-third",["dollar"],function(b){return{Deferred:b.Deferred,when:b.when,isPromise:function(c){return c&&"function"==typeof c.then}}}),d("promise",["promise-third"],function(b){return b}),d("base",["dollar","promise"],function(a,n){function m(b){return function(){return i.apply(b,arguments)}}function l(g,c){return function(){return g.apply(c,arguments)}}function k(g){var c;return Object.create?Object.create(g):(c=function(){},c.prototype=g,new c)}var j=function(){},i=Function.call;return{version:"0.1.2",$:a,Deferred:n.Deferred,isPromise:n.isPromise,when:n.when,browser:function(p){var o={},v=p.match(/WebKit\/([\d.]+)/),u=p.match(/Chrome\/([\d.]+)/)||p.match(/CriOS\/([\d.]+)/),t=p.match(/MSIE\s([\d\.]+)/)||p.match(/(?:trident)(?:.*rv:([\w.]+))?/i),s=p.match(/Firefox\/([\d.]+)/),r=p.match(/Safari\/([\d.]+)/),q=p.match(/OPR\/([\d.]+)/);return v&&(o.webkit=parseFloat(v[1])),u&&(o.chrome=parseFloat(u[1])),t&&(o.ie=parseFloat(t[1])),s&&(o.firefox=parseFloat(s[1])),r&&(o.safari=parseFloat(r[1])),q&&(o.opera=parseFloat(q[1])),o}(navigator.userAgent),os:function(h){var g={},p=h.match(/(?:Android);?[\s\/]+([\d.]+)?/),o=h.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return p&&(g.android=parseFloat(p[1])),o&&(g.ios=parseFloat(o[1].replace(/_/g,"."))),g}(navigator.userAgent),inherits:function(b,o,h){var g;return"function"==typeof o?(g=o,o=null):g=o&&o.hasOwnProperty("constructor")?o.constructor:function(){return b.apply(this,arguments)},a.extend(!0,g,b,h||{}),g.__super__=b.prototype,g.prototype=k(b.prototype),o&&a.extend(!0,g.prototype,o),g},noop:j,bindFn:l,log:function(){return e.console?l(console.log,console):j}(),nextTick:function(){return function(b){setTimeout(b,1)}}(),slice:m([].slice),guid:function(){var b=0;return function(g){for(var o=(+new Date).toString(32),h=0;5>h;h++){o+=Math.floor(65535*Math.random()).toString(32)}return(g||"wu_")+o+(b++).toString(32)}}(),formatSize:function(h,g,p){var o;for(p=p||["B","K","M","G","TB"];(o=p.shift())&&h>1024;){h/=1024}return("B"===o?h:h.toFixed(g||2))+o}}}),d("mediator",["base"],function(j){function i(h,g,r,q){return m.grep(h,function(b){return !(!b||g&&b.e!==g||r&&b.cb!==r&&b.cb._cb!==r||q&&b.ctx!==q)})}function p(h,g,q){m.each((h||"").split(k),function(b,c){q(c,g)})}function o(h,g){for(var t,s=!1,r=-1,q=h.length;++r<q;){if(t=h[r],t.cb.apply(t.ctx2,g)===!1){s=!0;break}}return !s}var n,m=j.$,l=[].slice,k=/\s+/;return n={on:function(g,c,r){var q,h=this;return c?(q=this._events||(this._events=[]),p(g,c,function(t,s){var u={e:t};u.cb=s,u.ctx=r,u.ctx2=r||h,u.id=q.length,q.push(u)}),this):this},once:function(g,c,q){var h=this;return c?(p(g,c,function(s,r){var t=function(){return h.off(s,t),r.apply(q||h,arguments)};t._cb=r,h.on(s,t,q)}),h):h},off:function(b,q,h){var c=this._events;return c?b||q||h?(p(b,q,function(g,r){m.each(i(c,g,r,h),function(){delete c[this.id]})}),this):(this._events=[],this):this},trigger:function(b){var q,h,g;return this._events&&b?(q=l.call(arguments,1),h=i(this._events,b),g=i(this._events,"all"),o(h,q)&&o(g,arguments)):this}},m.extend({installTo:function(b){return m.extend(b,n)}},n)}),d("uploader",["base","mediator"],function(h,g){function j(b){this.options=i.extend(!0,{},j.options,b),this._init(this.options)}var i=h.$;return j.options={},g.installTo(j.prototype),i.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(k,c){j.prototype[k]=function(){return this.request(c,arguments)}}),i.extend(j.prototype,{state:"pending",_init:function(k){var c=this;c.request("init",k,function(){c.state="ready",c.trigger("ready")})},option:function(l,k){var m=this.options;return arguments.length>1?void (i.isPlainObject(k)&&i.isPlainObject(m[l])?i.extend(m[l],k):m[l]=k):l?m[l]:m},getStats:function(){var b=this.request("get-stats");return{successNum:b.numOfSuccess,cancelNum:b.numOfCancel,invalidNum:b.numOfInvalid,uploadFailNum:b.numOfUploadFailed,queueNum:b.numOfQueue}},trigger:function(b){var m=[].slice.call(arguments,1),l=this.options,k="on"+b.substring(0,1).toUpperCase()+b.substring(1);return g.trigger.apply(this,arguments)===!1||i.isFunction(l[k])&&l[k].apply(this,m)===!1||i.isFunction(this[k])&&this[k].apply(this,m)===!1||g.trigger.apply(g,[this,b].concat(m))===!1?!1:!0},request:h.noop}),h.create=j.create=function(b){return new j(b)},h.Uploader=j,j}),d("runtime/runtime",["base","mediator"],function(h,g){function l(a){this.options=k.extend({container:document.body},a),this.uid=h.guid("rt_")}var k=h.$,j={},i=function(m){for(var c in m){if(m.hasOwnProperty(c)){return c}}return null};return k.extend(l.prototype,{getContainer:function(){var n,m,o=this.options;return this._container?this._container:(n=k(o.container||document.body),m=k(document.createElement("div")),m.attr("id","rt_"+this.uid),m.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.append(m),n.addClass("webuploader-container"),this._container=m,m)},init:h.noop,exec:h.noop,destroy:function(){this._container&&this._container.parentNode.removeChild(this.__container),this.off()}}),l.orders="html5,flash",l.addRuntime=function(m,c){j[m]=c},l.hasRuntime=function(b){return !!(b?j[b]:i(j))},l.create=function(m,c){var o,n;if(c=c||l.orders,k.each(c.split(/\s*,\s*/g),function(){return j[this]?(o=this,!1):void 0}),o=o||i(j),!o){throw new Error("Runtime Error")}return n=new j[o](m)},g.installTo(l.prototype),l}),d("runtime/client",["base","mediator","runtime/runtime"],function(h,g,k){function j(a,m){var l,c=h.Deferred();this.uid=h.guid("client_"),this.runtimeReady=function(b){return c.done(b)},this.connectRuntime=function(n,o){if(l){throw new Error("already connected!")}return c.done(o),"string"==typeof n&&i.get(n)&&(l=i.get(n)),l=l||i.get(null,m),l?(h.$.extend(l.options,n),l.__promise.then(c.resolve),l.__client++):(l=k.create(n,n.runtimeOrder),l.__promise=c.promise(),l.once("ready",c.resolve),l.init(),i.add(l),l.__client=1),m&&(l.__standalone=m),l},this.getRuntime=function(){return l},this.disconnectRuntime=function(){l&&(l.__client--,l.__client<=0&&(i.remove(l),delete l.__promise,l.destroy()),l=null)},this.exec=function(){if(l){var b=h.slice(arguments);return a&&b.unshift(a),l.exec.apply(this,b)}},this.getRuid=function(){return l&&l.uid},this.destroy=function(b){return function(){b&&b.apply(this,arguments),this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()}}(this.destroy)}var i;return i=function(){var b={};return{add:function(a){b[a.uid]=a},get:function(a,m){var l;if(a){return b[a]}for(l in b){if(!m||!b[l].__standalone){return b[l]}}return null},remove:function(a){delete b[a.uid]}}}(),g.installTo(j.prototype),j}),d("lib/blob",["base","runtime/client"],function(h,g){function i(b,k){var j=this;j.source=k,j.ruid=b,g.call(j,"Blob"),this.uid=k.uid||this.uid,this.type=k.type||"",this.size=k.size||0,b&&j.connectRuntime(b)}return h.inherits(g,{constructor:i,slice:function(j,c){return this.exec("slice",j,c)},getSource:function(){return this.source}}),i}),d("lib/file",["base","lib/blob"],function(h,g){function k(b,m){var l;g.apply(this,arguments),this.name=m.name||"untitled"+j++,l=i.exec(m.name)?RegExp.$1.toLowerCase():"",!l&&this.type&&(l=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(this.type)?RegExp.$1.toLowerCase():"",this.name+="."+l),!this.type&&~"jpg,jpeg,png,gif,bmp".indexOf(l)&&(this.type="image/"+("jpg"===l?"jpeg":l)),this.ext=l,this.lastModifiedDate=m.lastModifiedDate||(new Date).toLocaleString()}var j=1,i=/\.([^.]+)$/;return h.inherits(g,k)}),d("lib/filepicker",["base","runtime/client","lib/file"],function(a,j,i){function h(b){if(b=this.options=g.extend({},h.options,b),b.container=g(b.id),!b.container.length){throw new Error("按钮指定错误")}b.innerHTML=b.innerHTML||b.label||b.container.html()||"",b.button=g(b.button||document.createElement("div")),b.button.html(b.innerHTML),b.container.html(b.button),j.call(this,"FilePicker",!0)}var g=a.$;return h.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"},a.inherits(j,{constructor:h,init:function(){var k=this,m=k.options,l=m.button;l.addClass("webuploader-pick"),k.on("all",function(b){var c;switch(b){case"mouseenter":l.addClass("webuploader-pick-hover");break;case"mouseleave":l.removeClass("webuploader-pick-hover");break;case"change":c=k.exec("getFiles"),k.trigger("select",g.map(c,function(n){return n=new i(k.getRuid(),n),n._refer=m.container,n}),m.container)}}),k.connectRuntime(m,function(){k.refresh(),k.exec("init",m),k.trigger("ready")}),g(e).on("resize",function(){k.refresh()})},refresh:function(){var l=this.getRuntime().getContainer(),k=this.options.button,o=k.outerWidth?k.outerWidth():k.width(),n=k.outerHeight?k.outerHeight():k.height(),m=k.offset();o&&n&&l.css({bottom:"auto",right:"auto",width:o+"px",height:n+"px"}).offset(m)},enable:function(){var b=this.options.button;b.removeClass("webuploader-pick-disable"),this.refresh()},disable:function(){var b=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"}),b.addClass("webuploader-pick-disable")},destroy:function(){this.runtime&&(this.exec("destroy"),this.disconnectRuntime())}}),h}),d("widgets/widget",["base","uploader"],function(j,i){function p(h){if(!h){return !1}var g=h.length,q=n.type(h);return 1===h.nodeType&&g?!0:"array"===q||"function"!==q&&"string"!==q&&(0===g||"number"==typeof g&&g>0&&g-1 in h)}function o(b){this.owner=b,this.options=b.options}var n=j.$,m=i.prototype._init,l={},k=[];return n.extend(o.prototype,{init:j.noop,invoke:function(h,g){var q=this.responseMap;return q&&h in q&&q[h] in this&&n.isFunction(this[q[h]])?this[q[h]].apply(this,g):l},request:function(){return this.owner.request.apply(this.owner,arguments)}}),n.extend(i.prototype,{_init:function(){var g=this,c=g._widgets=[];return n.each(k,function(b,a){c.push(new a(g))}),m.apply(g,arguments)},request:function(y,x,w){var v,u,t,s,r=0,q=this._widgets,g=q.length,c=[],a=[];for(x=p(x)?x:[x];g>r;r++){v=q[r],u=v.invoke(y,x),u!==l&&(j.isPromise(u)?a.push(u):c.push(u))}return w||a.length?(t=j.when.apply(j,a),s=t.pipe?"pipe":"then",t[s](function(){var h=j.Deferred(),z=arguments;return setTimeout(function(){h.resolve.apply(h,z)},1),h.promise()})[s](w||j.noop)):c[0]}}),i.register=o.register=function(a,r){var q,h={init:"init"};return 1===arguments.length?(r=a,r.responseMap=h):r.responseMap=n.extend(h,a),q=j.inherits(o,r),k.push(q),q},o}),d("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(h,g,j){var i=h.$;return i.extend(g.options,{pick:null,accept:null}),g.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(b){return this.pickers=[],b.pick&&this.addButton(b.pick)},refresh:function(){i.each(this.pickers,function(){this.refresh()})},addButton:function(a){var o,n,m,l=this,k=l.options,c=k.accept;if(a){return m=h.Deferred(),i.isPlainObject(a)||(a={id:a}),o=i.extend({},a,{accept:i.isPlainObject(c)?[c]:c,swf:k.swf,runtimeOrder:k.runtimeOrder}),n=new j(o),n.once("ready",m.resolve),n.on("select",function(b){l.owner.request("add-file",[b])}),n.init(),this.pickers.push(n),m.promise()}},disable:function(){i.each(this.pickers,function(){this.disable()})},enable:function(){i.each(this.pickers,function(){this.enable()})}})}),d("lib/image",["base","runtime/client","lib/blob"],function(h,g,k){function j(b){this.options=i.extend({},j.options,b),g.call(this,"Image"),this.on("load",function(){this._info=this.exec("info"),this._meta=this.exec("meta")})}var i=h.$;return j.options={quality:90,crop:!1,preserveHeaders:!0,allowMagnify:!0},h.inherits(g,{constructor:j,info:function(b){return b?(this._info=b,this):this._info},meta:function(b){return b?(this._meta=b,this):this._meta},loadFromBlob:function(m){var l=this,n=m.getRuid();this.connectRuntime(n,function(){l.exec("init",l.options),l.exec("loadFromBlob",m)})},resize:function(){var a=h.slice(arguments);return this.exec.apply(this,["resize"].concat(a))},getAsDataUrl:function(b){return this.exec("getAsDataUrl",b)},getAsBlob:function(l){var c=this.exec("getAsBlob",l);return new k(this.getRuid(),c)}}),j}),d("widgets/image",["base","uploader","lib/image","widgets/widget"],function(h,g,k){var j,i=h.$;return j=function(m){var l=0,o=[],n=function(){for(var a;o.length&&m>l;){a=o.shift(),l+=a[0],a[1]()}};return function(b,p,c){o.push([p,c]),b.once("destroy",function(){l-=p,setTimeout(n,1)}),setTimeout(n,1)}}(5242880),i.extend(g.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}}),g.register({"make-thumb":"makeThumb","before-send-file":"compressImage"},{makeThumb:function(l,c,p,o){var n,m;return l=this.request("get-file",l),l.type.match(/^image/)?(n=i.extend({},this.options.thumb),i.isPlainObject(p)&&(n=i.extend(n,p),p=null),p=p||n.width,o=o||n.height,m=new k(n),m.once("load",function(){l._info=l._info||m.info(),l._meta=l._meta||m.meta(),m.resize(p,o)}),m.once("complete",function(){c(!1,m.getAsDataUrl(n.type)),m.destroy()}),m.once("error",function(){c(!0),m.destroy()}),void j(m,l.source.size,function(){l._info&&m.info(l._info),l._meta&&m.meta(l._meta),m.loadFromBlob(l.source)})):void c(!0)},compressImage:function(a){var n,m,l=this.options.compress||this.options.resize,c=l&&l.compressSize||307200;return a=this.request("get-file",a),!l||!~"image/jpeg,image/jpg".indexOf(a.type)||a.size<c||a._compressed?void 0:(l=i.extend({},l),m=h.Deferred(),n=new k(l),m.always(function(){n.destroy(),n=null}),n.once("error",m.reject),n.once("load",function(){a._info=a._info||n.info(),a._meta=a._meta||n.meta(),n.resize(l.width,l.height)}),n.once("complete",function(){var b,p;try{b=n.getAsBlob(l.type),p=a.size,b.size<p&&(a.source=b,a.size=b.size,a.trigger("resize",b.size,p)),a._compressed=!0,m.resolve()}catch(o){m.resolve()}}),a._info&&n.info(a._info),a._meta&&n.meta(a._meta),n.loadFromBlob(a.source),m.promise())}})}),d("file",["base","mediator"],function(r,q){function p(){return m+l++}function o(b){this.name=b.name||"Untitled",this.size=b.size||0,this.type=b.type||"application",this.lastModifiedDate=b.lastModifiedDate||1*new Date,this.id=p(),this.ext=k.exec(this.name)?RegExp.$1:"",this.statusText="",j[this.id]=o.Status.INITED,this.source=b,this.loaded=0,this.on("error",function(c){this.setStatus(o.Status.ERROR,c)})}var n=r.$,m="WU_FILE_",l=0,k=/\.([^.]+)$/,j={};return n.extend(o.prototype,{setStatus:function(h,g){var i=j[this.id];"undefined"!=typeof g&&(this.statusText=g),h!==i&&(j[this.id]=h,this.trigger("statuschange",h,i))},getStatus:function(){return j[this.id]},getSource:function(){return this.source},destory:function(){delete j[this.id]}}),q.installTo(o.prototype),o.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},o}),d("queue",["base","mediator","file"],function(h,g,l){function k(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0},this._queue=[],this._map={}}var j=h.$,i=l.Status;return j.extend(k.prototype,{append:function(b){return this._queue.push(b),this._fileAdded(b),this},prepend:function(b){return this._queue.unshift(b),this._fileAdded(b),this},getFile:function(b){return"string"!=typeof b?b:this._map[b]},fetch:function(n){var m,p,o=this._queue.length;for(n=n||i.QUEUED,m=0;o>m;m++){if(p=this._queue[m],n===p.getStatus()){return p}}return null},sort:function(b){"function"==typeof b&&this._queue.sort(b)},getFiles:function(){for(var n,m=[].slice.call(arguments,0),q=[],p=0,o=this._queue.length;o>p;p++){n=this._queue[p],(!m.length||~j.inArray(n.getStatus(),m))&&q.push(n)}return q},_fileAdded:function(n){var m=this,o=this._map[n.id];o||(this._map[n.id]=n,n.on("statuschange",function(b,p){m._onFileStatusChange(b,p)})),n.setStatus(i.QUEUED)},_onFileStatusChange:function(n,m){var o=this.stats;switch(m){case i.PROGRESS:o.numOfProgress--;break;case i.QUEUED:o.numOfQueue--;break;case i.ERROR:o.numOfUploadFailed--;break;case i.INVALID:o.numOfInvalid--}switch(n){case i.QUEUED:o.numOfQueue++;break;case i.PROGRESS:o.numOfProgress++;break;case i.ERROR:o.numOfUploadFailed++;break;case i.COMPLETE:o.numOfSuccess++;break;case i.CANCELLED:o.numOfCancel++;break;case i.INVALID:o.numOfInvalid++}}}),g.installTo(k.prototype),k}),d("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(r,q,p,o,n,m){var l=r.$,k=/\.\w+$/,j=o.Status;return q.register({"sort-files":"sortFiles","add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile",retry:"retry",reset:"reset","accept-file":"acceptFile"},{init:function(x){var w,v,u,t,s,g,c,a=this;if(l.isPlainObject(x.accept)&&(x.accept=[x.accept]),x.accept){for(s=[],u=0,v=x.accept.length;v>u;u++){t=x.accept[u].extensions,t&&s.push(t)}s.length&&(g="\\."+s.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"),a.accept=new RegExp(g,"i")}return a.queue=new p,a.stats=a.queue.stats,"html5"===this.request("predict-runtime-type")?(w=r.Deferred(),c=new m("Placeholder"),c.connectRuntime({runtimeOrder:"html5"},function(){a._ruid=c.getRuid(),w.resolve()}),w.promise()):void 0},_wrapFile:function(b){if(!(b instanceof o)){if(!(b instanceof n)){if(!this._ruid){throw new Error("Can't add external files.")}b=new n(this._ruid,b)}b=new o(b)}return b},acceptFile:function(g){var c=!g||g.size<6||this.accept&&k.exec(g.name)&&!this.accept.test(g.name);return !c},_addFile:function(g){var c=this;return g=c._wrapFile(g),c.owner.trigger("beforeFileQueued",g)?c.acceptFile(g)?(c.queue.append(g),c.owner.trigger("fileQueued",g),g):void c.owner.trigger("error","Q_TYPE_DENIED",g):void 0},getFile:function(b){return this.queue.getFile(b)},addFiles:function(g){var c=this;g.length||(g=[g]),g=l.map(g,function(b){return c._addFile(b)}),c.owner.trigger("filesQueued",g),c.options.auto&&c.request("start-upload")},getStats:function(){return this.stats},removeFile:function(g){var c=this;g=g.id?g:c.queue.getFile(g),g.setStatus(j.CANCELLED),c.owner.trigger("fileDequeued",g)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(h,g){var u,t,s,i=this;if(h){return h=h.id?h:i.queue.getFile(h),h.setStatus(j.QUEUED),void (g||i.request("start-upload"))}for(u=i.queue.getFiles(j.ERROR),t=0,s=u.length;s>t;t++){h=u[t],h.setStatus(j.QUEUED)}i.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.queue=new p,this.stats=this.queue.stats}})}),d("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(g,c){return g.support=function(){return c.hasRuntime.apply(c,arguments)},g.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType()){throw Error("Runtime Error")}},predictRuntmeType:function(){var b,j,i=this.options.runtimeOrder||c.orders,h=this.type;if(!h){for(i=i.split(/\s*,\s*/g),b=0,j=i.length;j>b;b++){if(c.hasRuntime(i[b])){this.type=h=i[b];break}}}return h}})}),d("lib/transport",["base","runtime/client","mediator"],function(h,g,k){function j(b){var l=this;b=l.options=i.extend(!0,{},j.options,b||{}),g.call(this,"Transport"),this._blob=null,this._formData=b.formData||{},this._headers=b.headers||{},this.on("progress",this._timeout),this.on("load error",function(){l.trigger("progress",1),clearTimeout(l._timer)})}var i=h.$;return j.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:120000,formData:{},headers:{},sendAsBinary:!1},i.extend(j.prototype,{appendBlob:function(m,l,p){var o=this,n=o.options;o.getRuid()&&o.disconnectRuntime(),o.connectRuntime(l.ruid,function(){o.exec("init")}),o._blob=l,n.fileVal=m||n.fileVal,n.filename=p||n.filename},append:function(l,c){"object"==typeof l?i.extend(this._formData,l):this._formData[l]=c},setRequestHeader:function(l,c){"object"==typeof l?i.extend(this._headers,l):this._headers[l]=c},send:function(b){this.exec("send",b),this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var l=this,c=l.options.timeout;c&&(clearTimeout(l._timer),l._timer=setTimeout(function(){l.abort(),l.trigger("error","timeout")},c))}}),k.installTo(j.prototype),j}),d("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(j,i,p,o){function n(y,x){for(var w,v=[],u=y.source,t=u.size,s=x?Math.ceil(t/x):1,r=0,q=0;s>q;){w=Math.min(x,t-r),v.push({file:y,start:r,end:x?r+w:t,total:t,chunks:s,chunk:q++}),r+=w}return y.blocks=v.concat(),y.remaning=v.length,{file:y,has:function(){return !!v.length},fetch:function(){return v.shift()}}}var m=j.$,l=j.isPromise,k=p.Status;m.extend(i.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:null}),i.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var a=this.owner;this.runing=!1,this.pool=[],this.pending=[],this.remaning=0,this.__tick=j.bindFn(this._tick,this),a.on("uploadComplete",function(b){b.blocks&&m.each(b.blocks,function(g,c){c.transport&&(c.transport.abort(),c.transport.destroy()),delete c.transport}),delete b.blocks,delete b.remaning})},start:function(){var a=this;m.each(a.request("get-files",k.INVALID),function(){a.request("remove-file",this)}),a.runing||(a.runing=!0,m.each(a.pool,function(b,h){var g=h.file;g.getStatus()===k.INTERRUPT&&(g.setStatus(k.PROGRESS),a._trigged=!1,h.transport&&h.transport.send())}),a._trigged=!1,a.owner.trigger("startUpload"),j.nextTick(a.__tick))},stop:function(g){var c=this;c.runing!==!1&&(c.runing=!1,g&&m.each(c.pool,function(q,h){h.transport&&h.transport.abort(),h.file.setStatus(k.INTERRUPT)}),c.owner.trigger("stopUpload"))},isInProgress:function(){return !!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(g,c){g=this.request("get-file",g),g.setStatus(c||k.COMPLETE),g.skipped=!0,g.blocks&&m.each(g.blocks,function(q,h){var r=h.transport;r&&(r.abort(),r.destroy(),delete h.transport)}),this.owner.trigger("uploadSkip",g)},_tick:function(){var a,q,h=this,g=h.options;return h._promise?h._promise.always(h.__tick):void (h.pool.length<g.threads&&(q=h._nextBlock())?(h._trigged=!1,a=function(c){h._promise=null,c&&c.file&&h._startSend(c),j.nextTick(h.__tick)},h._promise=l(q)?q.always(a):a(q)):h.remaning||h.getStats().numOfQueue||(h.runing=!1,h._trigged||j.nextTick(function(){h.owner.trigger("uploadFinished")}),h._trigged=!0))},_nextBlock:function(){var h,g,s=this,r=s._act,q=s.options;return r&&r.has()&&r.file.getStatus()===k.PROGRESS?(q.prepareNextFile&&!s.pending.length&&s._prepareNextFile(),r.fetch()):s.runing?(!s.pending.length&&s.getStats().numOfQueue&&s._prepareNextFile(),h=s.pending.shift(),g=function(b){return b?(r=n(b,q.chunked?q.chunkSize:0),s._act=r,r.fetch()):null},l(h)?h[h.pipe?"pipe":"then"](g):g(h)):void 0},_prepareNextFile:function(){var h,g=this,r=g.request("fetch-file"),q=g.pending;r&&(h=g.request("before-send-file",r,function(){return r.getStatus()===k.QUEUED?(g.owner.trigger("uploadStart",r),r.setStatus(k.PROGRESS),r):g._finishFile(r)}),h.done(function(){var a=m.inArray(h,q);~a&&q.splice(a,1,r)}),h.fail(function(b){r.setStatus(k.ERROR,b),g.owner.trigger("uploadError",r,b),g.owner.trigger("uploadComplete",r)}),q.push(h))},_popBlock:function(g){var c=m.inArray(g,this.pool);this.pool.splice(c,1),g.file.remaning--,this.remaning--},_startSend:function(a){var q,h=this,g=a.file;h.pool.push(a),h.remaning++,a.blob=1===a.chunks?g.source:g.source.slice(a.start,a.end),q=h.request("before-send",a,function(){g.getStatus()===k.PROGRESS?h._doSend(a):(h._popBlock(a),j.nextTick(h.__tick))}),q.fail(function(){1===g.remaning?h._finishFile(g).always(function(){a.percentage=1,h._popBlock(a),h.owner.trigger("uploadComplete",g),j.nextTick(h.__tick)}):(a.percentage=1,h._popBlock(a),j.nextTick(h.__tick))})},_doSend:function(x){var w,v,u=this,t=u.owner,s=u.options,r=x.file,q=new o(s),h=m.extend({},s.formData),a=m.extend({},s.headers);x.transport=q,q.on("destroy",function(){delete x.transport,u._popBlock(x),j.nextTick(u.__tick)}),q.on("progress",function(b){var y=0,g=0;y=x.percentage=b,x.chunks>1&&(m.each(r.blocks,function(z,c){g+=(c.percentage||0)*(c.end-c.start)}),y=g/r.size),t.trigger("uploadProgress",r,y||0)}),w=function(b){var g;return v=q.getResponseAsJson()||{},v._raw=q.getResponse(),g=function(c){b=c},t.trigger("uploadAccept",x,v,g)||(b=b||"server"),b},q.on("error",function(b,c){x.retried=x.retried||0,x.chunks>1&&~"http,abort".indexOf(b)&&x.retried<s.chunkRetry?(x.retried++,q.send()):(c||"server"!==b||(b=w(b)),r.setStatus(k.ERROR,b),t.trigger("uploadError",r,b),t.trigger("uploadComplete",r))}),q.on("load",function(){var b;return(b=w())?void q.trigger("error",b,!0):void (1===r.remaning?u._finishFile(r,v):q.destroy())}),h=m.extend(h,{id:r.id,name:r.name,type:r.type,lastModifiedDate:r.lastModifiedDate,size:r.size}),x.chunks>1&&m.extend(h,{chunks:x.chunks,chunk:x.chunk}),t.trigger("uploadBeforeSend",x,h,a),q.appendBlob(s.fileVal,x.blob,r.name),q.append(h),q.setRequestHeader(a),q.send()},_finishFile:function(h,g,r){var q=this.owner;return q.request("after-send-file",arguments,function(){h.setStatus(k.COMPLETE),q.trigger("uploadSuccess",h,g,r)}).fail(function(a){h.getStatus()===k.PROGRESS&&h.setStatus(k.ERROR,a),q.trigger("uploadError",h,a)}).always(function(){q.trigger("uploadComplete",h)})}})}),d("runtime/compbase",[],function(){function b(g,c){this.owner=g,this.options=g.options,this.getRuntime=function(){return c},this.getRuid=function(){return c.uid},this.trigger=function(){return g.trigger.apply(g,arguments)}}return b}),d("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(a,l,k){function j(){var b={},g=this,c=this.destory;l.apply(g,arguments),g.type=i,g.exec=function(r,q){var p,o=this,n=o.uid,m=a.slice(arguments,2);return h[r]&&(p=b[n]=b[n]||new h[r](o,g),p[q])?p[q].apply(p,m):void 0},g.destory=function(){return c&&c.apply(this,arguments)}}var i="html5",h={};return a.inherits(l,{constructor:j,init:function(){var b=this;setTimeout(function(){b.trigger("ready")},1)}}),j.register=function(b,m){var g=h[b]=a.inherits(k,m);return g},e.Blob&&e.FileReader&&e.DataView&&l.addRuntime(i,j),j}),d("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(g,c){return g.register("Blob",{slice:function(b,j){var i=this.owner.source,h=i.slice||i.webkitSlice||i.mozSlice;return i=h.call(i,b,j),new c(this.getRuid(),i)}})}),d("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(h,g){var i=h.$;return g.register("FilePicker",{init:function(){var t,s,r,q,p=this.getRuntime().getContainer(),o=this,n=o.owner,m=o.options,l=i(document.createElement("label")),c=i(document.createElement("input"));if(c.attr("type","file"),c.attr("name",m.name),c.addClass("webuploader-element-invisible"),l.on("click",function(){c.trigger("click")}),l.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),m.multiple&&c.attr("multiple","multiple"),m.accept&&m.accept.length>0){for(t=[],s=0,r=m.accept.length;r>s;s++){t.push(m.accept[s].mimeTypes)}c.attr("accept",t.join(","))}p.append(c),p.append(l),q=function(b){n.trigger(b.type)},c.on("change",function(k){var j,u=arguments.callee;o.files=k.target.files,j=this.cloneNode(!0),this.parentNode.replaceChild(j,this),c.off(),c=i(j).on("change",u).on("mouseenter mouseleave",q),n.trigger("change")}),l.on("mouseenter mouseleave",q)},getFiles:function(){return this.files},destroy:function(){}})}),d("runtime/html5/util",["base"],function(a){var i=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL,h=a.noop,g=h;return i&&(h=function(){return i.createObjectURL.apply(i,arguments)},g=function(){return i.revokeObjectURL.apply(i,arguments)}),{createObjectURL:h,revokeObjectURL:g,dataURL2Blob:function(k){var j,p,o,n,m,l;for(l=k.split(","),j=~l[0].indexOf("base64")?atob(l[1]):decodeURIComponent(l[1]),o=new ArrayBuffer(j.length),p=new Uint8Array(o),n=0;n<j.length;n++){p[n]=j.charCodeAt(n)}return m=l[0].split(":")[1].split(";")[0],this.arrayBufferToBlob(o,m)},dataURL2ArrayBuffer:function(k){var j,n,m,l;for(l=k.split(","),j=~l[0].indexOf("base64")?atob(l[1]):decodeURIComponent(l[1]),n=new Uint8Array(j.length),m=0;m<j.length;m++){n[m]=j.charCodeAt(m)}return n.buffer},arrayBufferToBlob:function(j,m){var l,k=e.BlobBuilder||e.WebKitBlobBuilder;return k?(l=new k,l.append(j),l.getBlob(m)):new Blob([j],m?{type:m}:{})},canvasToDataUrl:function(k,j,l){return k.toDataURL(j,l/100)},parseMeta:function(j,c){c(!1,{})},updateImageHead:function(b){return b}}}),d("runtime/html5/imagemeta",["runtime/html5/util"],function(g){var c;return c={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(i,h){var k=this,j=new FileReader;j.onload=function(){h(!1,k._parse(this.result)),j=j.onload=j.onerror=null},j.onerror=function(b){h(b.message),j=j.onload=j.onerror=null},i=i.slice(0,k.maxMetaDataSize),j.readAsArrayBuffer(i.getSource())},_parse:function(v,u){if(!(v.byteLength<6)){var t,s,r,q,p=new DataView(v),o=2,n=p.byteLength-4,m=o,b={};if(65496===p.getUint16(0)){for(;n>o&&(t=p.getUint16(o),t>=65504&&65519>=t||65534===t)&&(s=p.getUint16(o+2)+2,!(o+s>p.byteLength));){if(r=c.parsers[t],!u&&r){for(q=0;q<r.length;q+=1){r[q].call(c,p,o,s,b)}}o+=s,m=o}m>6&&(b.imageHead=v.slice?v.slice(2,m):new Uint8Array(v).subarray(2,m))}return b}},updateImageHead:function(i,h){var m,l,k,j=this._parse(i,!0);return k=2,j.imageHead&&(k=2+j.imageHead.byteLength),l=i.slice?i.slice(k):new Uint8Array(i).subarray(k),m=new Uint8Array(h.byteLength+2+l.byteLength),m[0]=255,m[1]=216,m.set(new Uint8Array(h),2),m.set(new Uint8Array(l),h.byteLength+2),m.buffer}},g.parseMeta=function(){return c.parse.apply(c,arguments)},g.updateImageHead=function(){return c.updateImageHead.apply(c,arguments)},c}),d("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(h,g){var i={};return i.ExifMap=function(){return this},i.ExifMap.prototype.map={Orientation:274},i.ExifMap.prototype.get=function(b){return this[b]||this[this.map[b]]},i.exifTagTypes={1:{getValue:function(j,c){return j.getUint8(c)},size:1},2:{getValue:function(j,c){return String.fromCharCode(j.getUint8(c))},size:1,ascii:!0},3:{getValue:function(k,j,l){return k.getUint16(j,l)},size:2},4:{getValue:function(k,j,l){return k.getUint32(j,l)},size:4},5:{getValue:function(k,j,l){return k.getUint32(j,l)/k.getUint32(j+4,l)},size:8},9:{getValue:function(k,j,l){return k.getInt32(j,l)},size:4},10:{getValue:function(k,j,l){return k.getInt32(j,l)/k.getInt32(j+4,l)},size:8}},i.exifTagTypes[7]=i.exifTagTypes[1],i.getExifValue=function(z,y,x,w,v,u){var t,s,r,q,p,c,a=i.exifTagTypes[w];if(!a){return void h.log("Invalid Exif data: Invalid tag type.")}if(t=a.size*v,s=t>4?y+z.getUint32(x+8,u):x+8,s+t>z.byteLength){return void h.log("Invalid Exif data: Invalid data offset.")}if(1===v){return a.getValue(z,s,u)}for(r=[],q=0;v>q;q+=1){r[q]=a.getValue(z,s+q*a.size,u)}if(a.ascii){for(p="",q=0;q<r.length&&(c=r[q],"\x00"!==c);q+=1){p+=c}return p}return r},i.parseExifTag=function(j,c,n,m,l){var k=j.getUint16(n,m);l.exif[k]=i.getExifValue(j,c,n,j.getUint16(n+2,m),j.getUint32(n+4,m),m)},i.parseExifTags=function(a,p,o,n,m){var l,k,j;if(o+6>a.byteLength){return void h.log("Invalid Exif data: Invalid directory offset.")}if(l=a.getUint16(o,n),k=o+2+12*l,k+4>a.byteLength){return void h.log("Invalid Exif data: Invalid directory size.")}for(j=0;l>j;j+=1){this.parseExifTag(a,p,o+2+12*j,n,m)}return a.getUint32(k,n)},i.parseExifData=function(a,n,m,l){var k,j,c=n+10;if(1165519206===a.getUint32(n+4)){if(c+8>a.byteLength){return void h.log("Invalid Exif data: Invalid segment size.")}if(0!==a.getUint16(n+8)){return void h.log("Invalid Exif data: Missing byte alignment offset.")}switch(a.getUint16(c)){case 18761:k=!0;break;case 19789:k=!1;break;default:return void h.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==a.getUint16(c+2,k)){return void h.log("Invalid Exif data: Missing TIFF marker.")}j=a.getUint32(c+4,k),l.exif=new i.ExifMap,j=i.parseExifTags(a,c,c+j,k,l)}},g.parsers[65505].push(i.parseExifData),i}),d("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(h,g,j){var i="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return g.register("Image",{modified:!1,init:function(){var k=this,c=new Image;c.onload=function(){k._info={type:k.type,width:this.width,height:this.height},k._metas||"image/jpeg"!==k.type?k.owner.trigger("load"):j.parseMeta(k._blob,function(a,l){k._metas=l,k.owner.trigger("load")})},c.onerror=function(){k.owner.trigger("error")},k._img=c},loadFromBlob:function(k){var c=this,l=c._img;c._blob=k,c.type=k.type,l.src=j.createObjectURL(k.getSource()),c.owner.once("load",function(){j.revokeObjectURL(l.src)})},resize:function(l,k){var m=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,m,l,k),this._blob=null,this.modified=!0,this.owner.trigger("complete")},getAsBlob:function(k){var c,m=this._blob,l=this.options;if(k=k||this.type,this.modified||this.type!==k){if(c=this._canvas,"image/jpeg"===k){if(m=j.canvasToDataUrl(c,"image/jpeg",l.quality),l.preserveHeaders&&this._metas&&this._metas.imageHead){return m=j.dataURL2ArrayBuffer(m),m=j.updateImageHead(m,this._metas.imageHead),m=j.arrayBufferToBlob(m,k)}}else{m=j.canvasToDataUrl(c,k)}m=j.dataURL2Blob(m)}return m},getAsDataUrl:function(k){var c=this.options;return k=k||this.type,"image/jpeg"===k?j.canvasToDataUrl(this._canvas,k,c.quality):this._canvas.toDataURL(k)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(b){return b?(this._info=b,this):this._info},meta:function(b){return b?(this._meta=b,this):this._meta},destroy:function(){var b=this._canvas;this._img.onload=null,b&&(b.getContext("2d").clearRect(0,0,b.width,b.height),b.width=b.height=0,this._canvas=null),this._img.src=i,this._img=this._blob=null},_resize:function(z,y,x,w){var v,u,t,s,r,q=this.options,p=z.width,o=z.height,n=this.getOrientation();~[5,6,7,8].indexOf(n)&&(x^=w,w^=x,x^=w),v=Math[q.crop?"max":"min"](x/p,w/o),q.allowMagnify||(v=Math.min(1,v)),u=p*v,t=o*v,q.crop?(y.width=x,y.height=w):(y.width=u,y.height=t),s=(y.width-u)/2,r=(y.height-t)/2,q.preserveHeaders||this._rotate2Orientaion(y,n),this._renderImageToCanvas(y,z,s,r,u,t)},_rotate2Orientaion:function(l,k){var o=l.width,n=l.height,m=l.getContext("2d");switch(k){case 5:case 6:case 7:case 8:l.width=n,l.height=o}switch(k){case 2:m.translate(o,0),m.scale(-1,1);break;case 3:m.translate(o,n),m.rotate(Math.PI);break;case 4:m.translate(0,n),m.scale(1,-1);break;case 5:m.rotate(0.5*Math.PI),m.scale(1,-1);break;case 6:m.rotate(0.5*Math.PI),m.translate(0,-n);break;case 7:m.rotate(0.5*Math.PI),m.translate(o,-n),m.scale(-1,1);break;case 8:m.rotate(-0.5*Math.PI),m.translate(-o,0)}},_renderImageToCanvas:function(){function a(v,u,t){var s,r,q,p=document.createElement("canvas"),o=p.getContext("2d"),n=0,m=t,l=t;for(p.width=1,p.height=t,o.drawImage(v,0,0),s=o.getImageData(0,0,1,t).data;l>n;){r=s[4*(l-1)+3],0===r?m=l:n=l,l=m+n>>1}return q=l/t,0===q?1:q}function k(m){var l,p,o=m.naturalWidth,n=m.naturalHeight;return o*n>1048576?(l=document.createElement("canvas"),l.width=l.height=1,p=l.getContext("2d"),p.drawImage(m,-o+1,0),0===p.getImageData(0,0,1,1).data[3]):!1}return h.os.ios?h.os.ios>=7?function(s,r,q,p,o,n){var m=r.naturalWidth,l=r.naturalHeight,b=a(r,m,l);return s.getContext("2d").drawImage(r,0,0,m*b,l*b,q,p,o,n)}:function(P,O,N,M,L,K){var J,I,H,G,F,E,D,C=O.naturalWidth,B=O.naturalHeight,A=P.getContext("2d"),z=k(O),y="image/jpeg"===this.type,x=1024,c=0,b=0;for(z&&(C/=2,B/=2),A.save(),J=document.createElement("canvas"),J.width=J.height=x,I=J.getContext("2d"),H=y?a(O,C,B):1,G=Math.ceil(x*L/C),F=Math.ceil(x*K/B/H);B>c;){for(E=0,D=0;C>E;){I.clearRect(0,0,x,x),I.drawImage(O,-E,-c),A.drawImage(J,0,0,x,x,N+D,M+b,G,F),E+=x,D+=G}c+=x,b+=F}A.restore(),J=I=null}:function(m,l,q,p,o,n){m.getContext("2d").drawImage(l,q,p,o,n)}}()})}),d("runtime/html5/jpegencoder",[],function(){function b(aW){function aV(v){for(var u=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],t=0;64>t;t++){var s=ay((u[t]*v+50)/100);1>s?s=1:s>255&&(s=255),ax[ag[t]]=s}for(var r=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],q=0;64>q;q++){var p=ay((r[q]*v+50)/100);1>p?p=1:p>255&&(p=255),aw[ag[q]]=p}for(var o=[1,1.387039845,1.306562965,1.175875602,1,0.785694958,0.5411961,0.275899379],n=0,m=0;8>m;m++){for(var l=0;8>l;l++){av[n]=1/(ax[ag[n]]*o[m]*o[l]*8),au[n]=1/(aw[ag[n]]*o[m]*o[l]*8),n++}}}function aU(i,h){for(var n=0,m=0,l=new Array,k=1;16>=k;k++){for(var j=1;j<=i[k];j++){l[h[m]]=[],l[h[m]][0]=n,l[h[m]][1]=k,m++,n++}n*=2}return l}function aT(){aD=aU(af,ae),aC=aU(ab,aa),aB=aU(ad,ac),aA=aU(Z,Y)}function aS(){for(var h=1,g=2,k=1;15>=k;k++){for(var j=h;g>j;j++){ar[32767+j]=k,at[32767+j]=[],at[32767+j][1]=k,at[32767+j][0]=j}for(var i=-(g-1);-h>=i;i++){ar[32767+i]=k,at[32767+i]=[],at[32767+i][1]=k,at[32767+i][0]=g-1+i}h<<=1,g<<=1}}function aR(){for(var c=0;256>c;c++){ah[c]=19595*c,ah[c+256>>0]=38470*c,ah[c+512>>0]=7471*c+32768,ah[c+768>>0]=-11059*c,ah[c+1024>>0]=-21709*c,ah[c+1280>>0]=32768*c+8421375,ah[c+1536>>0]=-27439*c,ah[c+1792>>0]=-5329*c}}function aQ(h){for(var g=h[0],i=h[1]-1;i>=0;){g&1<<i&&(an|=1<<am),i--,am--,0>am&&(255==an?(aP(255),aP(0)):aP(an),am=7,an=0)}}function aP(c){ao.push(ai[c])}function aO(c){aP(c>>8&255),aP(255&c)}function aN(bL,bK){var bJ,bI,bH,bG,bF,bE,bD,bC,bB,bA=0,bz=8,by=64;for(bB=0;bz>bB;++bB){bJ=bL[bA],bI=bL[bA+1],bH=bL[bA+2],bG=bL[bA+3],bF=bL[bA+4],bE=bL[bA+5],bD=bL[bA+6],bC=bL[bA+7];var bx=bJ+bC,bw=bJ-bC,bv=bI+bD,bu=bI-bD,bt=bH+bE,bs=bH-bE,br=bG+bF,bq=bG-bF,bp=bx+br,bo=bx-br,bn=bv+bt,bm=bv-bt;bL[bA]=bp+bn,bL[bA+4]=bp-bn;var bk=0.707106781*(bm+bo);bL[bA+2]=bo+bk,bL[bA+6]=bo-bk,bp=bq+bs,bn=bs+bu,bm=bu+bw;var bj=0.382683433*(bp-bm),bi=0.5411961*bp+bj,bh=1.306562965*bm+bj,bg=0.707106781*bn,bf=bw+bg,be=bw-bg;bL[bA+5]=be+bi,bL[bA+3]=be-bi,bL[bA+1]=bf+bh,bL[bA+7]=bf-bh,bA+=8}for(bA=0,bB=0;bz>bB;++bB){bJ=bL[bA],bI=bL[bA+8],bH=bL[bA+16],bG=bL[bA+24],bF=bL[bA+32],bE=bL[bA+40],bD=bL[bA+48],bC=bL[bA+56];var bd=bJ+bC,bc=bJ-bC,bb=bI+bD,ba=bI-bD,a9=bH+bE,a8=bH-bE,a7=bG+bF,a6=bG-bF,a5=bd+a7,a4=bd-a7,a3=bb+a9,a2=bb-a9;bL[bA]=a5+a3,bL[bA+32]=a5-a3;var a1=0.707106781*(a2+a4);bL[bA+16]=a4+a1,bL[bA+48]=a4-a1,a5=a6+a8,a3=a8+ba,a2=ba+bc;var a0=0.382683433*(a5-a2),aZ=0.5411961*a5+a0,aY=1.306562965*a2+a0,aX=0.707106781*a3,F=bc+aX,bl=bc-aX;bL[bA+40]=bl+aZ,bL[bA+24]=bl-aZ,bL[bA+8]=F+aY,bL[bA+56]=F-aY,bA++}var bM;for(bB=0;by>bB;++bB){bM=bL[bB]*bK[bB],aq[bB]=bM>0?bM+0.5|0:bM-0.5|0}return aq}function aM(){aO(65504),aO(16),aP(74),aP(70),aP(73),aP(70),aP(0),aP(1),aP(1),aP(0),aO(1),aO(1),aP(0),aP(0)}function aL(g,c){aO(65472),aO(17),aP(8),aO(c),aO(g),aP(3),aP(1),aP(17),aP(0),aP(2),aP(17),aP(1),aP(3),aP(17),aP(1)}function aK(){aO(65499),aO(132),aP(0);for(var g=0;64>g;g++){aP(ax[g])}aP(1);for(var c=0;64>c;c++){aP(aw[c])}}function aJ(){aO(65476),aO(418),aP(0);for(var i=0;16>i;i++){aP(af[i+1])}for(var h=0;11>=h;h++){aP(ae[h])}aP(16);for(var p=0;16>p;p++){aP(ad[p+1])}for(var o=0;161>=o;o++){aP(ac[o])}aP(1);for(var n=0;16>n;n++){aP(ab[n+1])}for(var m=0;11>=m;m++){aP(aa[m])}aP(17);for(var l=0;16>l;l++){aP(Z[l+1])}for(var k=0;161>=k;k++){aP(Y[k])}}function aI(){aO(65498),aO(12),aP(3),aP(1),aP(0),aP(2),aP(17),aP(3),aP(17),aP(0),aP(63),aP(0)}function aH(N,M,L,K,J){for(var I,H=J[0],G=J[240],F=16,E=63,D=64,C=aN(N,M),B=0;D>B;++B){ap[ag[B]]=C[B]}var A=ap[0]-L;L=ap[0],0==A?aQ(K[0]):(I=32767+A,aQ(K[ar[I]]),aQ(at[I]));for(var z=63;z>0&&0==ap[z];z--){}if(0==z){return aQ(H),L}for(var y,x=1;z>=x;){for(var w=x;0==ap[x]&&z>=x;++x){}var j=x-w;if(j>=F){y=j>>4;for(var g=1;y>=g;++g){aQ(G)}j=15&j}I=32767+ap[x],aQ(J[(j<<4)+ar[I]]),aQ(at[I]),x++}return z!=E&&aQ(H),L}function aG(){for(var g=String.fromCharCode,c=0;256>c;c++){ai[c]=g(c)}}function aF(g){if(0>=g&&(g=1),g>100&&(g=100),az!=g){var h=0;h=Math.floor(50>g?5000/g:200-2*g),aV(h),az=g}}function aE(){aW||(aW=50),aG(),aT(),aS(),aR(),aF(aW)}var aD,aC,aB,aA,az,ay=(Math.round,Math.floor),ax=new Array(64),aw=new Array(64),av=new Array(64),au=new Array(64),at=new Array(65535),ar=new Array(65535),aq=new Array(64),ap=new Array(64),ao=[],an=0,am=7,al=new Array(64),ak=new Array(64),aj=new Array(64),ai=new Array(256),ah=new Array(2048),ag=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],af=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],ae=[0,1,2,3,4,5,6,7,8,9,10,11],ad=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ac=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ab=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],aa=[0,1,2,3,4,5,6,7,8,9,10,11],Z=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Y=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(M,L){L&&aF(L),ao=new Array,an=0,am=7,aO(65496),aM(),aK(),aL(M.width,M.height),aJ(),aI();var K=0,J=0,I=0;an=0,am=7,this.encode.displayName="_encode_";for(var H,C,B,v,t,n,m,l,w,u=M.data,r=M.width,p=M.height,o=4*r,k=0;p>k;){for(H=0;o>H;){for(t=o*k+H,n=t,m=-1,l=0,w=0;64>w;w++){l=w>>3,m=4*(7&w),n=t+l*o+m,k+l>=p&&(n-=o*(k+1+l-p)),H+m>=o&&(n-=H+m-o+4),C=u[n++],B=u[n++],v=u[n++],al[w]=(ah[C]+ah[B+256>>0]+ah[v+512>>0]>>16)-128,ak[w]=(ah[C+768>>0]+ah[B+1024>>0]+ah[v+1280>>0]>>16)-128,aj[w]=(ah[C+1280>>0]+ah[B+1536>>0]+ah[v+1792>>0]>>16)-128}K=aH(al,av,K,aD,aB),J=aH(ak,au,J,aC,aA),I=aH(aj,au,I,aC,aA),H+=32}k+=8}if(am>=0){var i=[];i[1]=am+1,i[0]=(1<<am+1)-1,aQ(i)}aO(65497);var g="data:image/jpeg;base64,"+btoa(ao.join(""));return ao=[],g},aE()}return b.encode=function(a,h){var g=new b(h);return g.encode(a)},b}),d("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(h,g,k){var j,i=h.canvasToDataUrl;h.canvasToDataUrl=function(c,r,q){var p,o,n,m,b;return k.os.android?("image/jpeg"===r&&"undefined"==typeof j&&(m=i.apply(null,arguments),b=m.split(","),m=~b[0].indexOf("base64")?atob(b[1]):decodeURIComponent(b[1]),m=m.substring(0,2),j=255===m.charCodeAt(0)&&216===m.charCodeAt(1)),"image/jpeg"!==r||j?i.apply(null,arguments):(o=c.width,n=c.height,p=c.getContext("2d"),g.encode(p.getImageData(0,0,o,n),q))):i.apply(null,arguments)}}),d("runtime/html5/transport",["base","runtime/html5/runtime"],function(h,g){var j=h.noop,i=h.$;return g.register("Transport",{init:function(){this._status=0,this._response=null},send:function(){var a,q,p,o=this.owner,n=this.options,m=this._initAjax(),l=o._blob,k=n.server;n.sendAsBinary?(k+=(/\?/.test(k)?"&":"?")+i.param(o._formData),q=l.getSource()):(a=new FormData,i.each(o._formData,function(b,r){a.append(b,r)}),a.append(n.fileVal,l.getSource(),n.filename||o._formData.name||"")),n.withCredentials&&"withCredentials" in m?(m.open(n.method,k,!0),m.withCredentials=!0):m.open(n.method,k),this._setRequestHeader(m,n.headers),q?(m.overrideMimeType("application/octet-stream"),h.os.android?(p=new FileReader,p.onload=function(){m.send(this.result),p=p.onload=null},p.readAsArrayBuffer(q)):m.send(q)):m.send(a)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var b=this._xhr;b&&(b.upload.onprogress=j,b.onreadystatechange=j,b.abort(),this._xhr=b=null)},destroy:function(){this.abort()},_initAjax:function(){var k=this,c=new XMLHttpRequest,l=this.options;return !l.withCredentials||"withCredentials" in c||"undefined"==typeof XDomainRequest||(c=new XDomainRequest),c.upload.onprogress=function(a){var m=0;return a.lengthComputable&&(m=a.loaded/a.total),k.trigger("progress",m)},c.onreadystatechange=function(){return 4===c.readyState?(c.upload.onprogress=j,c.onreadystatechange=j,k._xhr=null,k._status=c.status,c.status>=200&&c.status<300?(k._response=c.responseText,k.trigger("load")):c.status>=500&&c.status<600?(k._response=c.responseText,k.trigger("error","server")):k.trigger("error",k._status?"http":"abort")):void 0},k._xhr=c,c},_setRequestHeader:function(k,c){i.each(c,function(a,l){k.setRequestHeader(a,l)})},_parseJson:function(l){var k;try{k=JSON.parse(l)}catch(m){k={}}return k}})}),d("webuploader",["base","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","runtime/html5/blob","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/image","runtime/html5/androidpatch","runtime/html5/transport"],function(b){return b}),f("webuploader")});