$(function(){Metronic.init();Layout.init();QuickSidebar.init();Demo.init();$(".date-picker").datepicker({rtl:Metronic.isRTL(),orientation:"left",autoclose:true});$("#cancle").click(function(){history.go(-1)});function f(){var n=$("#merchantNo").val();var j=$("#payCode").val();var o=$("#id").val();var m=$("#baseUrl").text().trim();var i=false;$.ajax({url:m+"/adminManage/merchantpayway/check",data:{merchantNo:n,payCode:j,id:o},type:"POST",async:false,success:function(p){p=$.parseJSON(p);i=p.check}});return i}function a(){var r=$("#merchantNo").val();var m=$("#payCode").val();var q=$("#t1Rate").val();var i=$("#t0Rate").val();var n=$("#rate").val();var p=$("#baseUrl").text().trim();var j=false;var o="";$.ajax({url:p+"/adminManage/merchantinfo/getMerchantInfo",data:{merchantNo:r},type:"POST",async:false,success:function(s){var t=$.parseJSON(s);$.ajax({url:p+"/adminManage/agentpayway/list",data:{agentNo:t.agentNo,payCode:m},type:"POST",async:false,success:function(v){var v=$.parseJSON(v);var u=v.objList;var w=v.objList[0];if(w.t1Rate>Number(q)){j=true;o+="商户的T1交易费率不能比代理商的低<br>"}if((w.t0Rate+w.t1Rate)>(Number(i)+Number(q))){j=true;o+="商户的T0垫资成本、T1交易费率之和不能比平台的低<br>"}if(w.rate>Number(n)){j=true;o+="商户的提现手续费不能比代理商的低<br>"}}})}});if(j){bootbox.alert(o,function(){})}return j}$.validator.addMethod("isNumOne",function(n,i){var m=n.length;var j=/^[0-9]+(\.[0-9]+)?$/;return this.optional(i)||(j.test(n))},"只能输入数字");$.validator.addMethod("isNumTwo",function(n,m){var j=/^[0]+(\.[0-9]{1,5})?$/;var i=true;if(m.id=="t0Rate"){i=j.test(n)}else{i=j.test(n)&&n!=0}return this.optional(m)||i},"请输入0~1之间的小数，且最多五位小数!");$("#form").validate({event:"blur",rules:{merchantNo:{required:true,maxlength:25},payCode:{required:true,maxlength:25},payName:{required:true,maxlength:25},t0Rate:{required:true,maxlength:25,isNumTwo:true},t1Rate:{required:true,maxlength:25,isNumTwo:true},rate:{required:true,maxlength:25,isNumOne:true},rateAmount:{required:true,maxlength:25},temp1:{required:true,maxlength:25},temp2:{required:true,maxlength:25}},messages:{merchantNo:{required:"请输入【商户编号】",maxlength:"长度不能超过25"},payCode:{required:"请输入【支付通道代码】",maxlength:"长度不能超过25"},payName:{required:"请输入【支付通道名称】",maxlength:"长度不能超过25"},t0Rate:{required:"请输入【T0费率】",maxlength:"长度不能超过25"},t1Rate:{required:"请输入【T1费率】",maxlength:"长度不能超过25"},rate:{required:"请输入【提现手续费率】",maxlength:"长度不能超过25"},rateAmount:{required:"请输入【固定手续费金额】",maxlength:"长度不能超过25"},temp1:{required:"请输入【temp1】",maxlength:"长度不能超过25"},temp2:{required:"请输入【temp2】",maxlength:"长度不能超过25"}},submitHandler:function(o){var i=0;var n="";if(f()!=true){i++;n+="商户下已存在该支付方式<br>"}if(a()==true){i++;return}if(i==0){$("#save").attr("disabled","disabled");var m=$("#baseUrl").text().trim();var j=$("#form").serialize();$.ajax({url:m+"/adminManage/merchantpayway/save",data:j,type:"POST",success:function(p){p=$.parseJSON(p);sweetRedirect(p,p.url)},error:function(p,r,q){$("#save").removeAttr("disabled")}})}else{$("#save").removeAttr("disabled");bootbox.alert(n,function(){})}return false},errorPlacement:function(i,j){i.appendTo(j.parent().parent())}});var l=$("select.form-control");for(var h=0;h<l.size();h++){var k=$(l[h]);var b=k.attr("id");var d=$("."+b).val();var c=k.find("option");for(var g=0;g<c.size();g++){var e=$(c[g]).val();if(e==d){$(c[g]).attr("selected","selected")}else{$(c[g]).removeClass("selected")}}}});