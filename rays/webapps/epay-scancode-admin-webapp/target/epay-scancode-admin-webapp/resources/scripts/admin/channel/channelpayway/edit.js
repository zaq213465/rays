$(function(){Metronic.init();Layout.init();QuickSidebar.init();Demo.init();$("#channelName").change(function(c){var d=$("#channelName").find("option:selected").attr("channelNo");$("#form").find("#channelNo").val(d)});$("#payName").change(function(d){var c=$("#payName").find("option:selected").attr("payCode");$("#form").find("#payCode").val(c)});$("#form").find("#cancle").click(function(){history.go(-1)});$.validator.addMethod("isNumOne",function(f,c){var e=f.length;var d=/^[0-9]+(\.[0-9]+)?$/;return this.optional(c)||(d.test(f))},"只能输入数字");$.validator.addMethod("isNumTwo",function(f,e){var d=/^[0]+(\.[0-9]{1,5})?$/;var c=true;if(e.id=="t0Rate"){c=d.test(f)}else{c=d.test(f)&&f!=0}return this.optional(e)||c},"请输入0~1之间的小数，且最多五位小数!");function b(){var e=$("#channelNo").val();var d=$("#payCode").val();var f=$("#id").val();var c=false;$.ajax({url:"check",data:{channelNo:e,payCode:d,id:f},type:"POST",async:false,success:function(g){g=$.parseJSON(g);c=g.check}});return c}function a(){var e=$("#payCode").val();var i=$("#t1Rate").val();var c=$("#t0Rate").val();var f=$("#rate").val();var h=$("#baseUrl").text().trim();var d=false;var g="";$.ajax({url:h+"/adminManage/platfromPayway/list",data:{payType:2,payCode:e},type:"POST",async:false,success:function(k){var k=$.parseJSON(k);var j=k.objList;var l=k.objList[0];if(l.t1Rate>Number(i)){d=true;g+="渠道的T1交易费率不能比平台的低<br>"}if((l.t0Rate+l.t1Rate)>(Number(c)+Number(i))){d=true;g+="渠道的T0垫资成本、T1交易费率之和不能比平台的低<br>"}}});if(d){bootbox.alert(g,function(){})}return d}$.validator.addMethod("isNumber",function(f,c){var e=f.length;var d=/^[0-9]*$/;return this.optional(c)||(d.test(f))},"只能输入数字");$("#form").validate({event:"submit",rules:{channelName:{required:true},payName:{required:true},t0Rate:{required:true,maxlength:10,isNumTwo:true},t1Rate:{required:true,maxlength:10,isNumTwo:true},rate:{required:true,maxlength:10,isNumOne:true},rateAmount:{required:true,maxlength:10,isNumOne:true}},messages:{channelName:{required:"请选择【渠道编号】",},payName:{required:"请选择【支付通道】",},t0Rate:{required:"请输入【提现手续费率】",maxlength:"长度不能超过10"},t1Rate:{required:"请输入【交易手续费率】",maxlength:"长度不能超过10"},rate:{required:"请输入【提现手续费】",maxlength:"长度不能超过10"},rateAmount:{required:"请输入【清算手续费】",maxlength:"长度不能超过10"}},submitHandler:function(c){var h=0;var f="";var l=$(".form-horizontal input[val='hidden']");for(var e=0;e<l.size();e++){var k=$(l[e]);var d=k.val();if(d==null||d==""){h++;f+=k.attr("name")+"不可为空!<br>"}}if(b()!=true){h++;f+="渠道下已存在该支付方式<br>"}if(a()){h++;return}if(h==0){$("#save").attr("disabled","disabled");var g=$("#baseUrl").text().trim();var j=$("#form").serialize();$.ajax({url:g+"/adminManage/channelpayway/save",data:j,type:"POST",success:function(i){i=$.parseJSON(i);bootbox.alert(i.values,function(){if(i.executeStatus=="0"){location.href=g+i.url}})}})}else{bootbox.alert(f,function(){})}return false},errorPlacement:function(c,d){c.appendTo(d.parent().parent())}})});