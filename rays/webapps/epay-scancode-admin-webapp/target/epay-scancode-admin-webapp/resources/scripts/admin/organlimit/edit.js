$(function(){Metronic.init();Layout.init();QuickSidebar.init();Demo.init();$(".date-picker").datetimepicker({format:"yyyy-mm-dd hh:ii",weekStart:0,autoclose:true,todayHighlight:true,defaultDate:new Date(),startDate:new Date(),keyboardNavigation:true,todayBtn:"linked",clearBtn:"linked",language:"zh-CN"});$("#form").find("#cancle").click(function(){var i=$("#baseUrl").text().trim();window.location.href=i+"/adminManage/organlimit"});$("#organNo").selectpicker({noneSelectedText:"  --  请选择  --  ",noneResultsText:"查无数据！ {0}",style:"btn-select"}).init(function(){$("#organNo").next().find("input").on("input",function(o){$("#organNo").empty();$("#organNo").append("<option value='0'>  --  不限  --  </option>");var i=$("#organNo").next().find("input").val().trim();var j=$("#baseUrl").text().trim();if(i!=""){$.ajax({url:j+"/adminManage/platfromAdviertisement/getorganlist",data:{organName:i},async:false,type:"POST",success:function(r){var r=JSON.parse(r);var s=r.objList;for(var p in s){var q="<option value='"+s[p].organNo+"'>"+s[p].organName+"</option>";$("#organNo").append(q)}}})}$("#organNo").selectpicker("refresh")});$("#organNo").selectpicker("val",$(".organNo").val())});function f(){var i=$("#limitType").val();if(i=="0"){$(".maxLimitDiv").hide();$("#maxLimit").val("")}else{$(".maxLimitDiv").show()}}$("#limitType").change(function(){f()});function a(){f()}var n=$("select.form-control");for(var k=0;k<n.size();k++){var m=$(n[k]);var b=m.attr("id");var d=$("."+b).val();var c=m.find("option");for(var h=0;h<c.size();h++){var e=$(c[h]).val();if(e==d){$(c[h]).attr("selected","selected")}else{$(c[h]).removeClass("selected")}}}$.validator.addMethod("isAmount",function(p,i){var o=p.length;var j=/^[0-9]+(\.[0-9]{1,2})?$/;return this.optional(i)||(j.test(p))},"请输入有效金额,最多两位小数");a();function l(){var o=$("#limitType").val();if(o!="0"){var i=$("#minLimit").val();var j=$("#maxLimit").val();if(Number(i)>Number(j)){return false}}return true}function g(){var o=$("#id").val();var i=false;var j=$("#baseUrl").text().trim();$.ajax({url:j+"/adminManage/organlimit/list",data:{organNo:$("#organNo").val(),limitType:$("#limitType").val(),limitPayCode:$("#limitPayCode").val(),limitMode:$("#limitMode").val()},type:"POST",async:false,success:function(q){var q=$.parseJSON(q);var p=q.objList;if(p.length==0){i=true}else{if(p.length==1){if(o==""){i=false}else{if(o!=p[0].id){i=false}else{i=true}}}}}});return i}$("#form").validate({event:"submit",rules:{limitType:{required:true},limitPayCode:{required:true},limitMode:{required:true},minLimit:{required:true,isAmount:true},maxLimit:{required:true,isAmount:true}},messages:{limitType:{required:"请选择【限额类型】",},limitPayCode:{required:"请选择【限额通道】",},limitMode:{required:"请选择【限制方式】"},minLimit:{required:"请输入【最低限额】"},maxLimit:{required:"请输入【最高限额】"}},submitHandler:function(s){var j=0;var r="";var p=true;var i=$("#organNo").val();if(i==""||i==null){$("#organNo").parent().parent().append('<label class="control-label error">请选择【机构名称】</label>');p=false}if(!p){return}if(!l()){j++;r+="最低限额不能比最高限额大<br>"}if(!g()){j++;r+="已存在该机构限额数据<br>"}if(j==0){var q=$("#baseUrl").text().trim();var o=$("#form").serialize();$.ajax({url:q+"/adminManage/organlimit/save",data:o,type:"POST",success:function(t){t=$.parseJSON(t);bootbox.alert(t.values,function(){if(t.executeStatus=="0"){location.href=q+t.url}})}})}else{bootbox.alert(r,function(){})}return false},errorPlacement:function(i,j){i.appendTo(j.parent().parent())}})});