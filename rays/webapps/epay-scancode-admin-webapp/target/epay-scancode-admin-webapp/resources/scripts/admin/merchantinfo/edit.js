$(function(){Metronic.init();Layout.init();QuickSidebar.init();Demo.init();$(".date-picker").datepicker({format:"yyyy-mm-dd",weekStart:0,autoclose:true,todayHighlight:true,defaultDate:new Date(),keyboardNavigation:true,todayBtn:"linked",clearBtn:"linked",language:"zh-CN"});$("#cancle").click(function(){history.go(-1)});$("#bankCard").on("keyup afterpaste",function(){var j=$(this).val();$(this).val(j.replace(/\D/g,""));if(j.length<2){$("#bankName").val("");$("#bankCode").val("")}var i=$("#baseUrl").text().trim();if(j.length>=2){$.ajax({type:"POST",url:i+"/adminManage/merchantbankcard/getBankInfo",data:{bankCard:j},success:function(n){if(n&&n!=""&&n!=null){var m=JSON.parse(n);$("#bankName").val(m.bankName);if(m.clearBankChannelNo==null){$("#bankCode").removeAttr("readonly")}else{$("#bankCode").val(m.clearBankChannelNo);$("#bankCode").attr("readonly","readonly")}$("#accountType").val("0");$("#accountType").attr("disabled","disabled")}else{$("#bankName").val("");$("#bankCode").val("");$("#accountType").val("0");$("#bankCode").removeAttr("readonly");$("#bankName").removeAttr("readonly");$("#accountType").removeAttr("disabled")}}})}});$("#channelNo").on("change",function(){var n=$(this).val();var j=$("#agentNo option");$("#agentNo").val("");for(var m=0;m<j.size();m++){var o=$(j[m]);o.css("display","block");var p=o.attr("val");if(p!=n&&n!=""&&p!="----"){o.css("display","none")}}});$("#province").change(function(j){var i=$("#province").val();var m=$("#baseUrl").text().trim();$("#city").empty();if(i!=""){$.ajax({url:m+"/adminManage/merchantinfo/getcityareacode",data:{pid:i},async:false,type:"POST",success:function(q){var q=JSON.parse(q);var p=q.cityList;if(p.length!=1){$("#city").append("<option value=''>  --  请选择  --  </option>")}else{$("#merchantArea").val(p[0].areacode)}var o="";for(var n in p){o+="<option value='"+p[n].areacode+"'>"+p[n].cname+"</option>"}$("#city").append(o)}})}});$("#city").change(function(i){var j=$("#city").val();if(j!=""){$("#merchantArea").val(j)}});function a(j){var j=j;var n=$("#id").val();var i=false;var m=$("#baseUrl").text().trim();$.ajax({url:m+"/adminManage/merchantinfo/existMobile",data:{mobile:j,id:n},type:"POST",async:false,success:function(o){if(o=="true"){i=true}}});return i}$("#mobile").blur(function(){var m=$(this);var i=m.attr("id");var j="手机号码已存在";if(a($("#mobile").val())&&$("#mobile").val().trim()!=""){$("#"+i+"-error").remove();m.parent().parent().append('<label id="'+i+'-error" class="error" for="'+i+'">'+j+"，不可用！</label>")}});$("#name").on("input",function(i){$("#myName").val($("#name").val())});$("#idCard").on("input",function(i){$("#myIdCard").val($("#idCard").val())});$("#accountType").change(function(i){var j=$("#accountType").val();if(j=="1"){$("#myName").val("");$("#myName").attr("readonly",false)}else{$("#myName").attr("readonly",true);$("#myName").val($("#name").val())}});$.validator.addMethod("isMobile",function(n,j){var m=n.length;var i=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(j)||(m==11&&i.test(n))},"请正确填写您的手机号码");$.validator.addMethod("isPhone",function(m,j){var i=/(^\d{3,4}-?\d{3,4}-?\d{3,4}$)|(^1[34578]{1}[0-9]{9}$)/;return this.optional(j)||(i.test(m))},"请正确填写您的电话号码");$.validator.addMethod("isLegalCard",function(m,j){var i=/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/;return this.optional(j)||(i.test(m))},"身份证格式错误");$.validator.addMethod("isNumber",function(n,i){var m=n.length;var j=/^[0-9]*$/;return this.optional(i)||(j.test(n))},"只能输入数字");$.validator.addMethod("isnotSpace",function(m,i){var j=m.trim().length;return this.optional(i)||(j!=0)},"不能是空白字符");$("#form").validate({event:"blur",rules:{channelNo:{required:true,maxlength:50},agentNo:{required:true,maxlength:50},merchantName:{required:true,maxlength:50},shortName:{required:true,maxlength:50},registerType:{required:true},busType:{required:true},name:{required:true,maxlength:30},idCard:{required:true,isLegalCard:true,maxlength:30},mobile:{required:true,isMobile:true,maxlength:20},phone:{required:true,isMobile:true,maxlength:11},email:{email:true,maxlength:50},address:{required:true,maxlength:50},merchantLicense:{required:true,maxlength:50},taxNo:{maxlength:50},orgNo:{maxlength:50},storeName:{required:true,maxlength:50},servicePhone:{required:true,isPhone:true,maxlength:20},storeAddress:{required:false,maxlength:250},contactName:{required:true,maxlength:10},merchantNature:{required:true},openYear:{required:false,isNumber:true,maxlength:5},contractNo:{required:false,maxlength:16},orgNo:{required:false,maxlength:25},mainBusiness:{required:false,maxlength:250},businessRange:{required:true,maxlength:500},registerAddr:{required:false,maxlength:500},merchantArea:{required:false,maxlength:10},remark:{required:false,maxlength:500},bankCode:{required:true,isnotSpace:true,maxlength:20},bankName:{required:true,isnotSpace:true,maxlength:100},bankCard:{required:true,isnotSpace:true,maxlength:25,isNumber:true},myIdCard:{required:true,isnotSpace:true,maxlength:30,isLegalCard:true},myName:{required:true,isnotSpace:true,maxlength:25},myMobile:{maxlength:20,isMobile:true},accountType:{required:true},myMobile:{required:true,isMobile:true,maxlength:20},city:{required:true},},messages:{channelNo:{required:"请输入【渠道编号】",maxlength:"长度不能超过50"},agentNo:{required:"请输入【代理商编号】",maxlength:"长度不能超过50"},merchantName:{required:"请输入【商户名称】",maxlength:"长度不能超过50"},shortName:{required:"请输入【商户简称】",maxlength:"长度不能超过50"},registerType:{required:"请输入【商户模式】"},busType:{required:"请输入【经营类型】",maxlength:"长度不能超过50"},name:{required:"请输入【法人姓名】",maxlength:"长度不能超过30"},idCard:{required:"请输入【法人身份证】",maxlength:"长度不能超过30"},mobile:{required:"请输入【手机号码】",maxlength:"长度不能超过20"},phone:{required:"请输入【联系电话】",maxlength:"长度不能超过20"},email:{email:"请输入正确的邮箱格式",maxlength:"长度不能超过100"},address:{maxlength:"长度不能超过50",required:"请输入【地址】"},merchantLicense:{maxlength:"长度不能超过50",required:"请输入【商户营业执照号】"},taxNo:{maxlength:"长度不能超过50"},orgNo:{maxlength:"长度不能超过50"},storeName:{required:"请输入【门店名称】",maxlength:"长度不能超过50"},servicePhone:{required:"请输入【服务电话】",maxlength:"长度不能超过20"},storeAddress:{required:"请输入【门店地址】",maxlength:"长度不能超过250"},contactName:{required:"请输入【联系人姓名】",maxlength:"长度不能超过10"},merchantNature:{required:"请选择【商户性质】"},openYear:{required:"请输入【经营年限】",maxlength:"长度不能超过5"},contractNo:{required:"请输入【合同编号】",maxlength:"长度不能超过16"},orgNo:{required:"请输入【组织机构代码】",maxlength:"长度不能超过25"},mainBusiness:{required:"请输入【主营业务】",maxlength:"长度不能超过250"},businessRange:{required:"请输入【经营范围】",maxlength:"长度不能超过500"},registerAddr:{required:"请输入【注册地址】",maxlength:"长度不能超过500"},merchantArea:{required:"请输入【地区】",maxlength:"长度不能超过10"},remark:{maxlength:"长度不能超过500"},bankCode:{required:"请输入【银行开户行代码】",maxlength:"长度不能超过20"},bankName:{required:"请输入【开户行银行名称】",maxlength:"长度不能超过100"},bankCard:{required:"请输入【银行卡号码】",maxlength:"长度不能超过25"},myIdCard:{required:"请输入【身份证号码】",maxlength:"长度不能超过30"},myName:{required:"请输入【姓名】",maxlength:"长度不能超过25"},myMobile:{maxlength:"长度不能超过20"},accountType:{required:"请选择【账户类型】"},myMobile:{required:"请输入【手机号码】",maxlength:"长度不能超过20"},city:{required:"请输入【地区】"},},submitHandler:function(m){var j=$("#id").val();if(j!=null&&j!=""){bootbox.setLocale("zh_CN");bootbox.confirm("提交修改将会导致您的商户重新进行审核，请确认是否要继续提交？",function(H){if(H){$(".bootbox-confirm.in").remove();$(".modal-backdrop.fade.in").remove();$("#save").attr("disabled","disabled");var C=0;var B="";if(a($("#mobile").val())){C++;B+="该手机号码在商户中已使用!"}var G=$(".form-horizontal input[val='hidden']");for(var z=0;z<G.size();z++){var E=$(G[z]);var x=E.val();if(x==null||x==""){C++;B+=E.attr("title")+"不可为空!"}}var y=$("#busType").val();if(y==""){C++;B="经营类型必须选择！<br/>"}if(C==0){var A=$("#baseUrl").text().trim();var F=$("#accountType").attr("disabled");$("#accountType").removeAttr("disabled");var D=$("#form").serialize();$("#accountType").attr("disabled",F);$.ajax({url:A+"/adminManage/merchantinfo/save",data:D,type:"POST",success:function(L){L=$.parseJSON(L);if(L.executeStatus=="0"){bootbox.alert(L.values,function(){window.location.href=L.url})}else{if(L.result=="0"){var J=L.paywayStatus;var K="";for(var I=0;I<J.length;I++){if(J[I].status=="2"){J[I].status="失败"}else{J[I].status="成功"}if(J[I].paycode=="zfb"){J[I].paycode="支付宝"}else{if(J[I].paycode=="wechat"){J[I].paycode="微信"}}if(I==J.length-1){K=K+J[I].paycode+" : "+J[I].status}else{K=K+J[I].paycode+" : "+J[I].status+"&nbsp;&nbsp;"}}bootbox.alert(K,function(){window.location.href="/adminManage/merchantinfo"})}else{if(L.executeStatus=="1"){$("#save").removeAttr("disabled");bootbox.alert(L.values,function(){})}}}},error:function(i,J,I){$("#save").removeAttr("disabled")}})}else{$("#save").removeAttr("disabled");bootbox.alert(B,function(){})}return false}})}else{$("#save").attr("disabled","disabled");var s=0;var r="";if(a($("#mobile").val())){s++;r+="该手机号码在商户中已使用!"}var w=$(".form-horizontal input[val='hidden']");for(var p=0;p<w.size();p++){var u=$(w[p]);var o=u.val();if(o==null||o==""){s++;r+=u.attr("title")+"不可为空!"}}var n=$("#busType").val();if(n==""){s++;r="经营类型必须选择！<br/>"}if(s==0){var q=$("#baseUrl").text().trim();var v=$("#accountType").attr("disabled");$("#accountType").removeAttr("disabled");var t=$("#form").serialize();$("#accountType").attr("disabled",v);$.ajax({url:q+"/adminManage/merchantinfo/save",data:t,type:"POST",success:function(i){i=$.parseJSON(i);if(i.executeStatus=="0"){bootbox.alert(i.values,function(){window.location.href=i.url})}else{$("#save").removeAttr("disabled");bootbox.alert(i.values,function(){})}},error:function(i,y,x){$("#save").removeAttr("disabled")}})}else{$("#save").removeAttr("disabled");bootbox.alert(r,function(){})}return false}},errorPlacement:function(i,j){i.appendTo(j.parent().parent())}});var l=$("select.form-control");for(var h=0;h<l.size();h++){var k=$(l[h]);var b=k.attr("id");var e=$("."+b).val();var c=k.find("option");for(var g=0;g<c.size();g++){var f=$(c[g]).val();if(f==e){$(c[g]).attr("selected","selected")}else{$(c[g]).removeClass("selected")}}}function d(n,q){var m=$("#baseUrl").text().trim();var j=$(n).find("option:selected").attr("categoryNo");if(typeof(j)=="undefined"){$("#busType").val("");$("#busTypeStr").text("");return}var i=$(n).find("option:selected").text();var p=i+"("+j+")";if(j=="null"||j==""){var o=$(n).val();$.ajax({url:m+"/adminManage/passageCategoryCmbc/list",data:{parentId:o,level:q},type:"POST",success:function(w){var t=JSON.parse(w);var r=t.objList;var v="<option  value='' selected = 'selected'>----请选择----</option>";for(var s in r){var u="<option value='"+r[s].id+"' categoryNo = '"+r[s].categoryNo+"'>"+r[s].name+"</option>";if(q==2){if(s==0){$("#categoryTwo").css("display","block");$("#categoryTwo").empty();$("#categoryTwo").append(v)}$("#categoryTwo").append(u)}else{if(q==3){if(s==0){$("#categoryThree").css("display","block");$("#categoryThree").empty();$("#categoryThree").append(v)}$("#categoryThree").append(u)}}}if(r.length==0){$("#categoryError").css("display","block");if(q==2){$("#categoryTwo").empty()}else{if(q==3){$("#categoryThree").empty()}}}else{$("#categoryError").css("display","none")}}})}else{$("#busType").val(j);$("#busTypeStr").text(p);if(q==2){$("#categoryTwo").css("display","none");$("#categoryThree").css("display","none")}else{if(q==3){$("#categoryThree").css("display","none")}}}}$("#categoryOne").change(function(){d(this,2)});$("#categoryTwo").change(function(){d(this,3)});$("#categoryThree").change(function(){var j=$(this).find("option:selected").attr("categoryNo");var i=$(this).find("option:selected").text();var m=i+"("+j+")";if(typeof(j)=="undefined"){$("#busType").val("");$("#busTypeStr").text("")}else{if(j==null||j==""){$("#categoryError").css("display","block")}else{$("#busType").val(j);$("#busTypeStr").text(m)}}})});