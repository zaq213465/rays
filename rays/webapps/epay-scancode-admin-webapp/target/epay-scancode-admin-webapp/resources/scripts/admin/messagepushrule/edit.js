$(function(){Metronic.init();Layout.init();QuickSidebar.init();Demo.init();$(".date-picker").datetimepicker({format:"yyyy-mm-dd hh:ii",weekStart:0,autoclose:true,todayHighlight:true,defaultDate:new Date(),startDate:new Date(),keyboardNavigation:true,todayBtn:"linked",clearBtn:"linked",language:"zh-CN"});$("#form").find("#cancle").click(function(){var i=$("#baseUrl").text().trim();window.location.href=i+"/adminManage/messagepushrule"});$("#channelNo").selectpicker({noneSelectedText:"  --  请选择  --  ",noneResultsText:"查无数据！ {0}",style:"btn-select"}).init(function(){$("#channelNo").next().find("input").on("input",function(l){$("#channelNo").empty();$("#channelNo").append("<option value=''>  --  请选择  --  </option>");var i=$("#channelNo").next().find("input").val().trim();var j=$("#baseUrl").text().trim();if(i!=""){$.ajax({url:j+"/adminManage/channelbase/list",data:{channelName:i},async:false,type:"POST",success:function(p){var p=JSON.parse(p);var m=p.objList;for(var n in m){var o="<option value='"+m[n].channelNo+"'>"+m[n].channelName+"</option>";$("#channelNo").append(o)}}})}$("#channelNo").selectpicker("refresh")});$("#channelNo").selectpicker("val",$(".channelNo").val())});function h(){var i=$("#messageType").val();if(i=="0"){$("#pushRule").attr("placeholder","请输入天数(天)");$("#pushRule").parent().parent().find("label.tip").remove();$("#pushRule").parent().after('<label class="control-label tip" style="text-align:left;">天</label>');$("#pushWay").val("0");$("#pushWay").attr("disabled","disabled")}else{if(i=="1"){$("#pushRule").attr("placeholder","请输入金额(元)");$("#pushRule").parent().parent().find("label.tip").remove();$("#pushRule").parent().after('<label class="control-label tip" style="text-align:left;">元</label>');$("#pushWay").val("1");$("#pushWay").attr("disabled","disabled")}else{if(i=="2"){$("#pushRule").attr("placeholder","请输入数量(个)");$("#pushRule").parent().parent().find("label.tip").remove();$("#pushRule").parent().after('<label class="control-label tip" style="text-align:left;">个</label>');$("#pushWay").val("1");$("#pushWay").attr("disabled","disabled")}else{$("#pushRule").attr("placeholder","");$("#pushRule").parent().parent().find("label.tip").remove();$("#pushWay").removeAttr("disabled")}}}}$("#messageType").change(function(i){h()});var k=$("select.form-control");for(var f=0;f<k.size();f++){var g=$(k[f]);var a=g.attr("id");var c=$("."+a).val();var b=g.find("option");for(var e=0;e<b.size();e++){var d=$(b[e]).val();if(d==c){$(b[e]).attr("selected","selected")}else{$(b[e]).removeClass("selected")}}}h();$("#form").validate({event:"submit",rules:{channelNo:{required:true},messageType:{required:true},pushRule:{required:true},pushTime:{required:true},pushWay:{required:true},firstPushDateStr:{required:true}},messages:{channelNo:{required:"请选择【渠道名称】",},messageType:{required:"请选择【消息类型】",},pushRule:{required:"请输入【推送规则】"},pushTime:{required:"请选择【推送频率】"},pushWay:{required:"请输入【推送方式】"},firstPushDateStr:{required:"请选择【首次推送日期】"}},submitHandler:function(j){var q=0;var p="";var m=true;var i=$("#channelNo").val();if(i==""){$("#channelNo").parent().parent().append('<label class="control-label error">请选择【渠道名称】</label>');m=false}var n=$("#messageType").val();var l=$("#temp1").val();if(n==2){if(l==""){$("#temp1").parent().parent().append('<label class="control-label error">请选择【代理商级别】</label>');m=false}}if(!m){return}if(n==0||n==1){if(isNaN($("#pushRule").val())){q++;p+="消息类型对应的推送规则必须是数字<br>"}}if(q==0){var s=$("#pushWay").attr("disabled");$("#pushWay").removeAttr("disabled");var o=$("#baseUrl").text().trim();var r=$("#form").serialize();$("#pushWay").attr("disabled",s);$.ajax({url:o+"/adminManage/messagepushrule/save",data:r,type:"POST",success:function(t){t=$.parseJSON(t);bootbox.alert(t.values,function(){if(t.executeStatus=="0"){location.href=o+t.url}})}})}else{bootbox.alert(p,function(){})}return false},errorPlacement:function(i,j){i.appendTo(j.parent().parent())}})});