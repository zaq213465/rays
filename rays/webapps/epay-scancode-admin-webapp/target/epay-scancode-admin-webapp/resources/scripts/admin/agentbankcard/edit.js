$(function(){Metronic.init();Layout.init();QuickSidebar.init();Demo.init();$(".date-picker").datepicker({rtl:Metronic.isRTL(),orientation:"left",autoclose:true});$("#cancle").click(function(){history.go(-1)});selectUtil.initAgent();$("#bankCard").on("keyup afterpaste",function(){var i=$(this).val();$(this).val(i.replace(/\D/g,""));if(i.length<2){$("#bankName").val("");$("#bankCode").val("")}if(i.length>=2&&i.length<11){$.ajax({type:"POST",url:"getBankInfo",data:{bankCard:i},success:function(m){$("#-error").remove();if(m&&m!=""&&m!=null){var j=JSON.parse(m);$("#bankName").val(j.bankName);if(j.clearBankChannelNo==null){$("#bankCode").removeAttr("readonly")}else{$("#bankCode").val(j.clearBankChannelNo);$("#bankCode").attr("readonly","readonly")}$("#accountType").val("0");$("#accountType").attr("disabled","disabled")}else{$("#bankName").val("");$("#bankCode").val("");$("#accountType").val("");$("#bankCode").removeAttr("readonly");$("#bankName").removeAttr("readonly");$("#accountType").removeAttr("disabled")}}})}});function f(){var j=$("#agentNo").val();var m=$("#id").val();var i=false;$.ajax({url:"check",data:{agentNo:j,id:m},type:"POST",async:false,success:function(n){n=$.parseJSON(n);i=n.check}});return i}var b={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};isCardNo=function(i){var j=/(^\d{15}$)|(^\d{17}(\d|X)$)/;if(j.test(i)===false){return false}return true};checkProvince=function(j){var i=j.substr(0,2);if(b[i]==undefined){return false}return true};checkBirthday=function(i){var j=i.length;if(j=="15"){var s=/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/;var n=i.match(s);var o=n[2];var m=n[3];var p=n[4];var q=new Date("19"+o+"/"+m+"/"+p);return verifyBirthday("19"+o,m,p,q)}if(j=="18"){var r=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/;var n=i.match(r);var o=n[2];var m=n[3];var p=n[4];var q=new Date(o+"/"+m+"/"+p);return verifyBirthday(o,m,p,q)}return false};verifyBirthday=function(n,q,i,o){var j=new Date();var m=j.getFullYear();if(o.getFullYear()==n&&(o.getMonth()+1)==q&&o.getDate()==i){var p=m-n;if(p>=3&&p<=100){return true}return false}return false};checkParity=function(p){p=changeFivteenToEighteen(p);var m=p.length;if(m=="18"){var o=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var r=0,q,n;for(q=0;q<17;q++){r+=p.substr(q,1)*o[q]}n=j[r%11];if(n==p.substr(17,1)){return true}return false}return false};changeFivteenToEighteen=function(n){if(n.length=="15"){var m=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var p=0,o;n=n.substr(0,6)+"19"+n.substr(6,n.length-6);for(o=0;o<17;o++){p+=n.substr(o,1)*m[o]}n+=j[p%11];return n}return n};$.validator.addMethod("isMobile",function(n,j){var m=n.length;var i=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(j)||(m==11&&i.test(n))},"请正确填写您的手机号码");$.validator.addMethod("isLegalCard",function(m,j){var i=/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/;return this.optional(j)||(i.test(m))},"身份证格式错误");$.validator.addMethod("isIllegalString",function(m,j){var i=/[@#\$%\^&\*]+/g;return this.optional(j)||(!i.test(m))},"不能使用非法字符");$.validator.addMethod("isBlank",function(j,i){return $.trim(j)!=""},"不能为空");$.validator.addMethod("isPhone",function(n,j){var m=n.length;var i=/(^\d{3,4}-?\d{3,4}-?\d{3,4}$)|(^1[34578]{1}[0-9]{9}$)/;return this.optional(j)||(i.test(n))},"请正确填写您的手机号码");$("#form").validate({event:"blur",rules:{agentNo:{required:true,maxlength:25},agentName:{required:true,maxlength:25},bankCode:{required:true,maxlength:25},bankName:{required:true,maxlength:25},bankCard:{required:true,maxlength:25},idCard:{required:true,maxlength:18,isIllegalString:true,isBlank:true},name:{required:true,maxlength:25,isIllegalString:true,isBlank:true},mobile:{required:true,maxlength:13,isPhone:true,isIllegalString:true,isBlank:true},accountType:{required:true,}},messages:{agentNo:{required:"请输入【代理商编号】",maxlength:"长度不能超过25"},agentName:{required:"请输入【代理商名称】",maxlength:"长度不能超过25"},bankCode:{required:"请输入【银行开户行代码】",maxlength:"长度不能超过25"},bankName:{required:"请输入【开户行银行名称（支行）】",maxlength:"长度不能超过25"},bankCard:{required:"请输入【银行卡号码】",maxlength:"长度不能超过25"},idCard:{required:"请输入【身份证号码】",maxlength:"长度不能超过18"},name:{required:"请输入【姓名】",maxlength:"长度不能超过25"},mobile:{required:"请输入【手机号码】",maxlength:"长度不能超过13"},accountType:{required:"请选择【是否对公对私】",}},submitHandler:function(p){var i=0;var o="";var j=$("#idCard").val();if(selectUtil.isNullAgentNo()){return}if(isCardNo(j)==false||checkProvince(j)==false||checkBirthday(j)==false||checkParity(j)==false){i++;o+="您输入的身份证号码不正确，请重新输入"}if(f()!=true){i++;o+="该代理商已存在账户，不能重复添加"}if(i==0){$("#save").attr("disabled","disabled");var n=$("#baseUrl").text().trim();var m=$("#form").serialize();$.ajax({url:n+"/adminManage/agentbankcard/save",data:m,type:"POST",success:function(q){q=$.parseJSON(q);bootbox.alert(q.values,function(){if(q.executeStatus=="0"){location.href=n+q.url}})}})}else{bootbox.alert(o,function(){})}return false},errorPlacement:function(i,j){i.appendTo(j.parent().parent())}});var l=$("select.form-control");for(var h=0;h<l.size();h++){var k=$(l[h]);var a=k.attr("id");var d=$("."+a).val();var c=k.find("option");for(var g=0;g<c.size();g++){var e=$(c[g]).val();if(e==d){$(c[g]).attr("selected","selected")}else{$(c[g]).removeClass("selected")}}}});