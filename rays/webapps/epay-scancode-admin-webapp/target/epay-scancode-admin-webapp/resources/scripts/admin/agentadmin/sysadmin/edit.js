$(function(){Metronic.init();Layout.init();QuickSidebar.init();Demo.init();$("#cancle").click(function(){history.go(-1)});selectUtil.initAgent();$("#channelCode").change(function(){var b=$(this).val();var c=$("#baseUrl").text().trim();$("#channelNo").val(b);if(b!=""){$.ajax({url:c+"/adminManage/agentbase/list",data:{channelNo:b},type:"POST",success:function(j){var e=$("#agentNo option")[0];$("#agentNo option").remove();$("#agentNo").append(e);var g=JSON.parse(j);var d=g.objList;for(var f in d){var h="<option value='"+d[f].agentNo+"'>"+d[f].agentName+"</option>";$("#agentNo").append(h)}if(d.length==0){$("#agentError").css("display","block")}else{$("#agentError").css("display","none")}$("#agentNo").selectpicker("refresh")}});$.ajax({url:c+"/adminManage/channel/role/roleList/findRoleByChannelCode",data:{channelCode:b,roleLevel:2},type:"POST",success:function(h){$("#roleId").val("");$("#roleId").empty();var e=JSON.parse(h);var g=e.roles;if(e.executeStatus=="0"){for(var d in e.roles){var f="<option value='"+g[d].id+"'>"+g[d].roleName+"</option>";$("#roleId").append(f)}if(e.roles.length==0){$("#roleError").css("display","block")}else{$("#roleError").css("display","none")}}}})}});$(".ajaxCheck").blur(function(){var f=$(this);f.parent().parent().find("label:gt(0)").remove();var h=f.val();var d=f.attr("id");var g=f.attr("placeholder");var b=0;var e="";if(h==null||h==""){b++;e="为空"}var c=/\w{0,32}$/;if(!c.test(h)){b++;e="需是数字、字母、下划线，且长度不可超过32"}c=/[@#\$%\^&\*]+/g;if(c.test(h)){b++;e="不能包含特殊字符"}if(b==0){$.ajax({type:"POST",url:"list",data:d+"="+h,async:false,success:function(k){f.parent().parent().find("label:gt(0)").remove();k=$.parseJSON(k);if(k.objList.length>1){b++;e="已存在"}if(k.objList.length==1){var i=$("#id").val();if(i==null||i==""){b++;e="已存在"}else{var j=k.objList[0];if(i!=j.id){b++;e="已存在"}}}}})}if(b==0){f.parent().parent().append('<label id="'+d+'-success" class="success" for="'+d+'">'+g+"可用！</label>")}else{f.parent().parent().append('<label id="'+d+'-error" class="error" for="'+d+'">'+g+e+"，不可用！</label>")}});function a(){var d=$("#agentNo").val();var c=$("#userName").val();var e=$("#id").val();var b=false;$.ajax({url:"check",data:{agentNo:d,userName:c,id:e},type:"POST",async:false,success:function(f){f=$.parseJSON(f);b=f.check}});return b}$.validator.addMethod("isNumChar",function(d,c){var b=/\w$/;return this.optional(c)||(b.test(d))},"请输入字母、数字、下划线!");$.validator.addMethod("isIllegalString",function(d,c){var b=/[@#\$%\^&\*]+/g;return this.optional(c)||(!b.test(d))},"不能使用非法字符");$.validator.addMethod("isBlank",function(c,b){return $.trim(c)!=""},"不能为空");$.validator.addMethod("isPhone",function(e,c){var d=e.length;var b=/(^\d{3,4}-?\d{3,4}-?\d{3,4}$)|(^1[34578]{1}[0-9]{9}$)/;return this.optional(c)||(b.test(e))},"请正确填写您的手机号码");$.validator.addMethod("isMobile",function(e,c){var d=e.length;var b=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(c)||(d==11&&b.test(e))},"请正确填写您的手机号码");$("#form").validate({event:"blur",rules:{userName:{required:true,maxlength:18,isNumChar:true,isIllegalString:true,isBlank:true},shortName:{required:true,maxlength:25,isIllegalString:true,isBlank:true},email:{email:true,maxlength:50},phone:{digits:true,isIllegalString:true,maxlength:13,isPhone:true,isBlank:true},password:{maxlength:25},passwordstr:{maxlength:25,}},messages:{userName:{required:"请输入【账户】",maxlength:"长度不能超过18",isNumChar:"请输入字母、数字、下划线!"},shortName:{required:"请输入【姓名】",maxlength:"长度不能超过25"},email:{email:"请输入正确的邮箱格式",maxlength:"长度不能超过50"},phone:{digits:"请输入正整数",maxlength:"长度不能超过13"},password:{maxlength:"长度不能超过25"},passwordstr:{maxlength:"长度不能超过25"}},submitHandler:function(c){var h=0;var g="";var b=$("#id").val();var k=$("#password").val();if((b==""||b==null)&&(k==""||k==null)){h++;g="请输入密码！"}if(k!=""&&k!=null){var e=/^[a-zA-Z]\w{5,17}$/;if(!e.test(k)){h++;g="密码以字母开头,长度在6~18之间,只能包含字母、数字和下划线!"}else{var l=$("#passwordstr").val();if(k.trim()!=l.trim()){h++;g="两次输入的密码需要一样!"}}}var j=$("#channelCode").val();if(j==""){h++;g="请选择渠道编号！"}var m=$("#agentNo").val();if(m==""||m==null){h++;g="请选择代理商名称！"}var d=$("#roleId").val();if(d==""||d==null){h++;g="请选择账户角色！"}if(a()!=true){h++;g+="账号已存在"}if(h==0){$("#save").attr("disabled","disabled");var f=$("#baseUrl").text().trim();var i=$("#form").serialize();$.ajax({url:f+"/adminManage/agentadmin/save",data:i,type:"POST",success:function(n){n=$.parseJSON(n);bootbox.alert(n.values,function(){if(n.executeStatus=="0"){location.href=f+n.url}})}})}else{$("#save").removeAttr("disabled");bootbox.alert(g,function(){})}return false},errorPlacement:function(b,c){b.appendTo(c.parent().parent())}})});