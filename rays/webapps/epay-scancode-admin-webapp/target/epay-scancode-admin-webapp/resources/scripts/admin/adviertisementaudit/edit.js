$(function(){Metronic.init();Layout.init();QuickSidebar.init();Demo.init();$(".date-picker").datepicker({format:"yyyy-mm-dd ",weekStart:0,autoclose:true,todayHighlight:true,defaultDate:new Date(),keyboardNavigation:true,todayBtn:"linked",clearBtn:"linked",language:"zh-CN"});$("#form").find("#cancle").click(function(){var i=$("#baseUrl").text().trim();window.location.href=i+"/adminManage/platfromAdviertisement"});$("#organNo").selectpicker({noneSelectedText:"  --  请选择  --  ",noneResultsText:"查无数据！ {0}",style:"btn-select"}).init(function(){$("#organNo").next().find("input").on("input",function(k){$("#organNo").empty();$("#organNo").append("<option value=''>  --  请选择  --  </option>");var i=$("#organNo").next().find("input").val().trim();var j=$("#baseUrl").text().trim();if(i!=""){$.ajax({url:j+"/adminManage/platfromAdviertisement/getorganlist",data:{organName:i},async:false,type:"POST",success:function(n){var n=JSON.parse(n);var o=n.objList;for(var l in o){var m="<option value='"+o[l].organNo+"'>"+o[l].organName+"</option>";$("#organNo").append(m)}}})}$("#organNo").selectpicker("refresh")});$(".selectpicker").selectpicker("val",$(".organNo").val())});$("#province").change(function(j){var i=$("#province").val();$("#adviertScope").val(i);var k=$("#baseUrl").text().trim();$("#city").empty();if(i!=""){$.ajax({url:k+"/adminManage/platfromAdviertisement/getcitylist",data:{pid:i},async:false,type:"POST",success:function(o){var o=JSON.parse(o);var n=o.cityList;if(n.length!=1){$("#city").append("<option value=''>  --  请选择  --  </option>")}else{$("#adviertScope").val(n[0].cid)}var m="";for(var l in n){m+="<option value='"+n[l].cid+"'>"+n[l].cname+"</option>"}$("#city").append(m)}})}});$("#city").change(function(i){var j=$("#city").val();if(j!=""){$("#adviertScope").val(j)}else{$("#adviertScope").val($("#province").val())}});var g=$("select.form-control");for(var b=0;b<g.size();b++){var d=$(g[b]);var h=d.attr("id");var f=$("."+h).val();var c=d.find("option");for(var a=0;a<c.size();a++){var e=$(c[a]).val();if(e==f){$(c[a]).attr("selected","selected")}else{$(c[a]).removeClass("selected")}}}$("#form").validate({event:"submit",rules:{beginTimeStr:{required:true},endTimeStr:{required:true},province:{required:false},preImgUrl:{required:true},adviertLink:{required:false}},messages:{beginTimeStr:{required:"请选择【生效日期】",},endTimeStr:{required:"请选择【结束日期】",},province:{required:"请选择【推广范围】"},preImgUrl:{required:"请上传【广告图片】"},adviertLink:{required:"请输入【广告链接】"}},submitHandler:function(m){var i=0;var l="";if($("#imgUrl").val()==""){i++;l="请上传广告图片"}if(i==0){var k=$("#baseUrl").text().trim();var j=$("#form").serialize();$.ajax({url:k+"/adminManage/platfromAdviertisement/save",data:j,type:"POST",success:function(n){n=$.parseJSON(n);bootbox.alert(n.values,function(){if(n.executeStatus=="0"){location.href=k+n.url}})}})}else{bootbox.alert(l,function(){})}return false},errorPlacement:function(i,j){i.appendTo(j.parent().parent())}})});