$(function(){Metronic.init();Layout.init();QuickSidebar.init();Demo.init();$("#form").find("#cancle").click(function(){history.go(-1)});$("#bankCard").on("keyup afterpaste",function(){var b=$(this).val();$(this).val(b.replace(/\D/g,""));if(b.length<2){$("#bankName").val("");$("#bankCode").val("")}var a=$("#baseUrl").text().trim();if(b.length>=2){$.ajax({type:"POST",url:a+"/adminManage/merchantbankcard/getBankInfo",data:{bankCard:b},success:function(d){if(d&&d!=""&&d!=null){var c=JSON.parse(d);$("#bankName").val(c.bankName);if(c.clearBankChannelNo==null){$("#bankCode").removeAttr("readonly")}else{$("#bankCode").val(c.clearBankChannelNo);$("#bankCode").attr("readonly","readonly")}$("#accountType").val("0");$("#accountType").attr("disabled","disabled")}else{$("#bankName").val("");$("#bankCode").val("");$("#accountType").val("");$("#bankCode").removeAttr("readonly");$("#bankName").removeAttr("readonly");$("#accountType").removeAttr("disabled")}}})}});jQuery.validator.addMethod("ischina",function(c,b){var a=/^[u4E00-u9FA5]+$/;return this.optional(b)||(a.test(c))},"不允许输入中文字符，请重新填写");$.validator.addMethod("isNumTwo",function(c,b){var a=/^[0-9]+(\.[0-9]{1,2})?$/;return this.optional(b)||(a.test(c))},"请输入整数、小数，且最多两位小数!");$.validator.addMethod("isMobile",function(d,b){var c=d.length;var a=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(b)||(c==11&&a.test(d))},"请正确填写您的手机号码");$.validator.addMethod("isCard",function(c,b){var a=/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/;return this.optional(b)||(a.test(c))},"身份证格式错误");$.validator.addMethod("isNumber",function(d,a){var c=d.length;var b=/^[0-9]*$/;return this.optional(a)||(b.test(d))},"只能输入数字");$("#form").validate({event:"submit",rules:{channelName:{required:true,maxlength:100},bankCode:{required:true,maxlength:20},bankName:{required:true,maxlength:100},bankCard:{required:true,maxlength:50,isNumber:true},idCard:{required:true,maxlength:30,isCard:true},name:{required:true,maxlength:100},mobile:{maxlength:20,isNumber:true,isMobile:true},balance:{isNumTwo:true}},messages:{channelName:{required:"请输入【渠道名称】",maxlength:"长度不能超过100"},bankCode:{required:"请输入【银行开户行代码】",maxlength:"长度不能超过20"},bankName:{required:"请输入【开户行银行名称】",maxlength:"长度不能超过100"},bankCard:{required:"请输入【银行卡号码】",maxlength:"长度不能超过50"},idCard:{required:"请输入【身份证号码】",maxlength:"长度不能超过30"},name:{required:"请输入【姓名】",maxlength:"长度不能超过100"},mobile:{maxlength:"长度不能超过20"},balance:{maxlength:"长度不能超过10"}},submitHandler:function(a){var f=0;var d="";var k=$(".form-horizontal input[val='hidden']");for(var c=0;c<k.size();c++){var h=$(k[c]);var b=h.val();if(b==null||b==""){f++;d+=h.attr("name")+"不可为空!"}}if(f==0){var e=$("#baseUrl").text().trim();var j=$("#accountType").attr("disabled");$("#accountType").removeAttr("disabled");var g=$("#form").serialize();$("#accountType").attr("disabled",j);$.ajax({url:e+"/adminManage/channelbankcard/save",data:g,type:"POST",success:function(i){i=$.parseJSON(i);bootbox.alert(i.values,function(){if(i.executeStatus=="0"){location.href=e+i.url}})}})}else{bootbox.alert(d,function(){})}return false},errorPlacement:function(a,b){a.appendTo(b.parent().parent())}})});